<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰) - Benjaminçš„æ±‚çŸ¥æ—…è®°</title><meta name="Description" content="æ‘˜è¦ï¼šEffective C&#43;&#43;(ç¬¬ä¸‰ç‰ˆ)å†…å®¹ç¬¬äº”ã€ç¬¬å…­ç« çš„æ€»ç»“"><meta property="og:title" content="Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)" />
<meta property="og:description" content="æ‘˜è¦ï¼šEffective C&#43;&#43;(ç¬¬ä¸‰ç‰ˆ)å†…å®¹ç¬¬äº”ã€ç¬¬å…­ç« çš„æ€»ç»“" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-14T10:12:42+08:00" />
<meta property="article:modified_time" content="2022-04-21T22:59:39+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)"/>
<meta name="twitter:description" content="æ‘˜è¦ï¼šEffective C&#43;&#43;(ç¬¬ä¸‰ç‰ˆ)å†…å®¹ç¬¬äº”ã€ç¬¬å…­ç« çš„æ€»ç»“"/>
<meta name="application-name" content="Benjaminçš„åšå®¢">
<meta name="apple-mobile-web-app-title" content="Benjaminçš„åšå®¢"><meta name="theme-color" content="#ffe5b3"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/favicon/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/" /><link rel="prev" href="https://kissingfire123.github.io/2022/01/11_effective-c-%E4%B9%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%E4%BA%8C/" /><link rel="next" href="https://kissingfire123.github.io/2022/02/18_%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8Fkatex%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)",
        "inLanguage": "zh-cn",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kissingfire123.github.io\/2022\/02\/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89\/"
        },"genre": "posts","keywords": "C\u002b\u002b, ç¨‹åºè®¾è®¡","wordcount":  14494 ,
        "url": "https:\/\/kissingfire123.github.io\/2022\/02\/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89\/","datePublished": "2022-02-14T10:12:42+08:00","dateModified": "2022-04-21T22:59:39+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Benjamin Lee"
            },"description": "æ‘˜è¦ï¼šEffective C++(ç¬¬ä¸‰ç‰ˆ)å†…å®¹ç¬¬äº”ã€ç¬¬å…­ç« çš„æ€»ç»“"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <a href="https://github.com/kissingfire123" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
        <div class="header-title">
            <a href="/" title="Benjaminçš„æ±‚çŸ¥æ—…è®°"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/img/home-logo.ico"
        data-srcset="/img/home-logo.ico, /img/home-logo.ico 1.5x, /img/home-logo.ico 2x"
        data-sizes="auto"
        alt="/img/home-logo.ico"
        title="/img/home-logo.ico" />Bejaminä¸»é¡µ</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/" title="æ–‡ç« å½’æ¡£"><i class='fas fa-thin fa-archive'></i> æ‰€æœ‰æ–‡ç«  </a><a class="menu-item" href="/tags/"><i class='fas fa-regular fa-tag'></i> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"><i class='fas fa-thin fa-folder-open'></i> åˆ†ç±» </a><a class="menu-item" href="/about/"><i class='fas fa-thin fa-user'></i> å…³äº </a><a class="menu-item" href="/friends/"><i class='fas fa-light fa-link'></i> å‹é“¾ </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Benjaminçš„æ±‚çŸ¥æ—…è®°"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/img/home-logo.ico"
        data-srcset="/img/home-logo.ico, /img/home-logo.ico 1.5x, /img/home-logo.ico 2x"
        data-sizes="auto"
        alt="/img/home-logo.ico"
        title="/img/home-logo.ico" />Bejaminä¸»é¡µ</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="æ–‡ç« å½’æ¡£"><i class='fas fa-thin fa-archive'></i>æ‰€æœ‰æ–‡ç« </a><a class="menu-item" href="/tags/" title=""><i class='fas fa-regular fa-tag'></i>æ ‡ç­¾</a><a class="menu-item" href="/categories/" title=""><i class='fas fa-thin fa-folder-open'></i>åˆ†ç±»</a><a class="menu-item" href="/about/" title=""><i class='fas fa-thin fa-user'></i>å…³äº</a><a class="menu-item" href="/friends/" title=""><i class='fas fa-light fa-link'></i>å‹é“¾</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)</h1><h2 class="single-subtitle">æ”¹å–„ç¨‹åºä¸è®¾è®¡çš„55ä¸ªå…·ä½“åšæ³•(Rule26-40)</h2><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Benjamin Lee</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"><i class="far fa-folder fa-fw"></i>ç¨‹åºè®¾è®¡</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-02-14">2022-02-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 14494 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 29 åˆ†é’Ÿ&nbsp;<span id="/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/" class="leancloud_visitors" data-flag-title="Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)">
                        <i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;æ¬¡é˜…è¯»
                    </span>&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/C&#43;&#43;-Pic/EffectiveC&#43;&#43;-FrontPage-part3.webp"
        data-srcset="/img/C&#43;&#43;-Pic/EffectiveC&#43;&#43;-FrontPage-part3.webp, /img/C&#43;&#43;-Pic/EffectiveC&#43;&#43;-FrontPage-part3.webp 1.5x, /img/C&#43;&#43;-Pic/EffectiveC&#43;&#43;-FrontPage-part3.webp 2x"
        data-sizes="auto"
        alt="/img/C&#43;&#43;-Pic/EffectiveC&#43;&#43;-FrontPage-part3.webp"
        title="æ‘˜è¦ï¼šEffective C&#43;&#43;(ç¬¬ä¸‰ç‰ˆ)å†…å®¹ç¬¬äº”ã€ç¬¬å…­ç« çš„æ€»ç»“" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#å‰è¨€">å‰è¨€</a></li>
    <li><a href="#ch5-å®ç°">CH5. å®ç°</a>
      <ul>
        <li><a href="#r26-å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´">R26 å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´</a></li>
        <li><a href="#r27-å°½é‡å°‘åšè½¬å‹åŠ¨ä½œ">R27 å°½é‡å°‘åšè½¬å‹åŠ¨ä½œ</a></li>
        <li><a href="#r28-é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†">R28 é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†</a></li>
        <li><a href="#r29-ä¸ºå¼‚å¸¸å®‰å…¨è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„">R29 ä¸ºâ€œå¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„</a>
          <ul>
            <li><a href="#å¼‚å¸¸å®‰å…¨çš„3ä¸ªç­‰çº§">å¼‚å¸¸å®‰å…¨çš„3ä¸ªç­‰çº§</a></li>
            <li><a href="#ä½¿ç”¨copy-and-swapä¿éšœå¼‚å¸¸å®‰å…¨">ä½¿ç”¨copy-and-swapä¿éšœå¼‚å¸¸å®‰å…¨</a></li>
            <li><a href="#å¼‚å¸¸å®‰å…¨çš„è¿å¸¦å½±å“side-effects">å¼‚å¸¸å®‰å…¨çš„è¿å¸¦å½±å“(side effects)</a></li>
          </ul>
        </li>
        <li><a href="#r30-é€å½»äº†è§£inlineçš„é‡Œé‡Œå¤–å¤–">R30 é€å½»äº†è§£inlineçš„é‡Œé‡Œå¤–å¤–</a></li>
        <li><a href="#r31-å°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾èµ–å…³ç³»é™è‡³æœ€ä½">R31 å°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾èµ–å…³ç³»é™è‡³æœ€ä½</a></li>
      </ul>
    </li>
    <li><a href="#ch6-ç»§æ‰¿ä¸é¢å‘å¯¹è±¡è®¾è®¡">CH6. ç»§æ‰¿ä¸é¢å‘å¯¹è±¡è®¾è®¡</a>
      <ul>
        <li><a href="#r32-ç¡®å®šä½ çš„publicç»§æ‰¿å¡‘é€ å‡ºis-aå…³ç³»">R32 ç¡®å®šä½ çš„publicç»§æ‰¿å¡‘é€ å‡º<strong>is-a</strong>å…³ç³»</a></li>
        <li><a href="#r33-é¿å…é®æ©ç”±ç»§æ‰¿å¾—æ¥çš„åç§°">R33 é¿å…é®æ©ç”±ç»§æ‰¿å¾—æ¥çš„åç§°</a></li>
        <li><a href="#r34-åŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿">R34 åŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿</a></li>
        <li><a href="#r35-è€ƒè™‘virtualå‡½æ•°çš„æ›¿ä»£é€‰æ‹©">R35 è€ƒè™‘virtualå‡½æ•°çš„æ›¿ä»£é€‰æ‹©</a></li>
        <li><a href="#r36-ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°">R36 ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°</a></li>
        <li><a href="#r37-ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå…¥å‚å€¼">R37 ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå…¥å‚å€¼</a></li>
        <li><a href="#r38-é€šè¿‡å¤åˆå¡‘é€ å‡ºhas-aæˆ–æ ¹æ®æŸç‰©å®ç°å‡º">R38 é€šè¿‡å¤åˆå¡‘é€ å‡º<strong>has-a</strong>æˆ–&quot;æ ¹æ®æŸç‰©å®ç°å‡º&rdquo;</a></li>
        <li><a href="#r39-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿">R39 æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿</a></li>
        <li><a href="#r40-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿">R40 æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="å‰è¨€">å‰è¨€</h1>
<p>è¿™æœ¬C++ç»å…¸è‘—ä½œï¼Œæœ¬äººçœ‹çš„æ˜¯ä¸­æ–‡ç‰ˆï¼Œä¾¯æ·è€å¸ˆç¿»è¯‘çš„ï¼Œç²¾è¯»åˆ†æå¹¶å®è·µæ¨æ•²åï¼Œæ•´ç†æˆåšå®¢è®°å½•ä¸‹æ¥ï¼Œéå¸¸é€‚åˆæœ‰ä¸€å®šå¼€å‘ç»éªŒçš„æœ‹å‹ä»¬é˜…è¯»ã€‚</p>
<blockquote>
<p>Effective-C++æ€»ç»“ç³»åˆ—åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸º<strong>ç¬¬ä¸‰éƒ¨åˆ†</strong>ï¼Œæ¶‰åŠåŸä¹¦ç¬¬5~6ç« ï¼Œå†…å®¹èŒƒå›´Rule26~40ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼Œ<strong>Rule26ç®€å†™ä¸ºR26</strong>ã€‚</p>
</blockquote>
<div class="details admonition abstract open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ul fa-fw"></i>Effective-C&#43;&#43;ç³»åˆ—List<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</p>
<p>ğŸ’¡ <a href="https://kissingfire123.github.io/2021/12/06_effective-c-%e4%b9%8b%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93%e4%b8%80/" target="_blank" rel="noopener noreffer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)</a></p>
<p>ğŸ’¡ <a href="https://kissingfire123.github.io/2022/01/11_effective-c-%e4%b9%8b%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93%e4%ba%8c/" target="_blank" rel="noopener noreffer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)</a></p>
<p>ğŸ’¡ <a href="https://kissingfire123.github.io/2022/02/14_effective-c-%e4%b9%8b%e9%98%85%e8%af%bb%e6%80%bb%e7%bb%93%e4%b8%89/" target="_blank" rel="noopener noreffer">Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)</a></p>
</div>
        </div>
    </div>
<p>ç”±äºåŸä¹¦åœ¨C++11ä¹‹å‰å†™æˆï¼Œæœ‰äº›ç°ä»£C++ç‰¹æ€§ä¸ä¼šæåŠï¼Œæ‰€ä»¥ä¼šæ ¹æ®æœ¬äºº<code>å¼€å‘ç»éªŒ</code>æ–°å¢ä¸€äº›ä¸ªäººæ„Ÿæ‚ŸğŸ‘‰<code>By the way</code>ç¯èŠ‚ã€‚</p>
<hr>
<h1 id="ch5-å®ç°">CH5. å®ç°</h1>
<h2 id="r26-å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´">R26 å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´</h2>
<ul>
<li>
<p>å°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°ï¼Œå¯å¢åŠ ç¨‹åºæ¸…æ™°åº¦å’Œæ•ˆç‡</p>
<ol>
<li>
<p>å®šä¹‰åï¼Œåœ¨ä½¿ç”¨å‰å°±é­é‡æŠ›å¼‚å¸¸</p>
<p>è¿™ç§æƒ…å†µï¼Œå¦‚æœæ˜¯å®šä¹‰äº†å¯¹è±¡<code>ObjectA a</code>ï¼Œä¾¿ç™½ç™½åœ°æµªè´¹äº†å¯¹è±¡açš„æ„é€ å’Œææ„æˆæœ¬ã€‚</p>
</li>
<li>
<p>ä¸åªæ˜¯å»¶åå˜é‡å®šä¹‰åˆ°ä½¿ç”¨æ—¶ï¼Œè€Œæ˜¯å°½é‡å»¶ååˆ°èƒ½ç»™å®ƒåˆå€¼æ—¶</p>
<p>ç»“åˆä¸Šè¿°ç¬¬1ï¼Œ2ç‚¹ï¼Œè€ƒè™‘ä»¥ä¸‹ä»£ç çš„åˆç†æ€§ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">encryptPassword</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">password</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">password</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">){</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&#34;Password is too short&#34;</span><span class="p">);</span>
	<span class="p">}</span><span class="c1">// è€ƒè™‘1ï¼šåœ¨å¼‚å¸¸ä¹‹åå®šä¹‰å˜é‡
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">encrypted</span><span class="p">(</span><span class="n">password</span><span class="p">);</span><span class="c1">//è€ƒè™‘2ï¼šå®šä¹‰å»¶åè‡³å˜é‡èƒ½èµ‹åˆå€¼çš„æ—¶æœº
</span><span class="c1"></span>    <span class="n">encrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">encrypted</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>æ€è€ƒå˜é‡å®šä¹‰<strong>æ˜¯å¦</strong>è¯¥åœ¨å¾ªç¯å†…</p>
<table>
    <tr>
        <td >æ–¹æ³•Aï¼šå®šä¹‰äºå¾ªç¯å¤–</td> 
        <td >æ–¹æ³•Bï¼šå®šä¹‰äºå¾ªç¯å†…</td>
    </tr>
    <tr>
        <td>
            Widget w;  <br> 
            for(int i = 0 ; i< n; ++i){ <br>
              &emsp; &emsp;   w = foo(i);       <br>        
              &emsp; &emsp;// other...<br> 
            }
        </td>
        <td>
            for(int i = 0 ; i< n; ++i){ <br>
             &emsp; &emsp; Widget w(foo(i));    <br> 
             &emsp; &emsp;// other...<br>  
            }
        </td>
    </tr>
    <tr>
        <td rowspan = "1">1ä¸ªæ„é€ +1ä¸ªææ„+nä¸ªèµ‹å€¼</td>
        <td rowspan = "1">nä¸ªæ„é€ +nä¸ªææ„</td>
    </tr>
</table>
</li>
</ol>
</li>
</ul>
<p><strong>ç©¶ç«Ÿæ˜¯Aè¿˜æ˜¯B</strong>æ–¹æ³•å¥½ï¼Œå–å†³äº <code>ä¸€ä¸ªèµ‹å€¼</code>æˆæœ¬å’Œ<code>ä¸€ç»„æ„é€ +ææ„</code>æˆæœ¬ï¼Œè¿™2è€…ä¹‹é—´ï¼Œå¦‚æœæ˜¯èµ‹å€¼æˆæœ¬ä½ï¼Œé‚£ä¹ˆAæ›´å¥½ï¼Œå¦åˆ™Bæ›´å¥½ã€‚</p>
<hr>
<h2 id="r27-å°½é‡å°‘åšè½¬å‹åŠ¨ä½œ">R27 å°½é‡å°‘åšè½¬å‹åŠ¨ä½œ</h2>
<p>é€šå¸¸çš„è½¬å‹æ˜¯å¯èƒ½ä¼šè¿™æ ·å†™ï¼šå‡½æ•°é£æ ¼çš„<code>int(expression)</code>æˆ–è€…Cé£æ ¼çš„<code>(int)expression</code>ï¼Œè¿™éƒ½è¢«æˆä¸ºâ€œ<em>æ—§å¼è½¬å‹</em> â€ã€‚</p>
<ul>
<li>
<p>åœ¨C++ä¸­ï¼Œæœ‰4ç§æ–°å¼è½¬å‹æ“ä½œç¬¦ï¼š</p>
<ol>
<li>
<p><strong>const_cast<T> (expression)</strong></p>
<p>ä½œç”¨æ˜¯ç§»é™¤å˜é‡çš„å¸¸é‡æ€§(cast away the constness)ï¼Œæ˜¯å”¯ä¸€æœ‰æ­¤èƒ½åŠ›çš„æ“ä½œç¬¦ã€‚</p>
</li>
<li>
<p><strong>dynamic_cast<T>(expression)</strong></p>
<p>ä½œç”¨æ˜¯â€œå®‰å…¨å‘ä¸‹è½¬å‹â€(safe downcasting)ï¼Œå†³å®šæŸä¸ªå¯¹è±¡æ˜¯å¦å±äºæŸç»§æ‰¿ä½“ç³»ã€‚è€—è´¹é‡å¤§è¿è¡Œæˆæœ¬ï¼ˆåŸå› ï¼šéœ€è¦æŸ¥è¯¢RTTIä¿¡æ¯ï¼Œè€Œä¸”ä¸åŒç¼–è¯‘å™¨å®ç°çš„æ–¹æ³•å’Œæ•ˆç‡æœ‰æ‰€ä¸åŒï¼‰ã€‚</p>
</li>
<li>
<p><strong>reinterpret_cast<T>(expression)</strong></p>
<p>æ‰§è¡Œä½çº§è½¬å‹ï¼Œå®é™…ç»“æœå–å†³äºç¼–è¯‘å™¨ï¼Œç§»æ¤æ€§å·®ã€‚ï¼ˆæ¯”å¦‚int* è½¬ä¸ºintï¼‰è¦æ¸…æ¥šè‡ªå·±åœ¨åšä»€ä¹ˆï¼Œæ…ç”¨ã€‚</p>
</li>
<li>
<p><strong>static_cast<T>(expression)</strong></p>
<p>å¼ºè¿«éšå¼ç±»å‹è½¬æ¢ï¼Œä»£æ›¿Cé£æ ¼çš„&quot;æ—§å¼è½¬æ¢&quot;ã€‚ä¹Ÿå¯ä»¥ç»™å˜é‡åŠ ä¸Šconstç‰¹æ€§ã€‚</p>
</li>
</ol>
<p>æ–°å¼è½¬æ¢çš„å¥½å¤„ï¼šå¾ˆå®¹æ˜“åœ¨ä»£ç æ‰¾åˆ°â€œç±»å‹ç³»ç»Ÿåœ¨ä½•å¤„è½¬å˜æˆ–ç ´åâ€ï¼›å¯¹constç‰¹æ€§çš„ä¸¥æ§ï¼Œè®©ç±»å‹ç³»ç»Ÿæ›´å¥å£®ã€‚</p>
</li>
<li>
<p>æ´¾ç”Ÿç±»é‡Œç›´æ¥è°ƒç”¨åŸºç±»æˆå‘˜å‡½æ•°æ—¶ï¼Œä¸è¦ç”¨è½¬å‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">SpecialWindow</span><span class="o">:</span><span class="k">public</span> <span class="n">Window</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">onResize</span><span class="p">(){</span>
      <span class="n">Window</span><span class="o">::</span><span class="n">onResize</span><span class="p">();</span><span class="c1">//ä¸è¦ä½¿ç”¨ static_cast&lt;Window&gt;(*this).onResize();
</span><span class="c1"></span>  <span class="p">}</span>  
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å…³äºdynamic_castéœ€è¦æ³¨æ„çš„</p>
<ol>
<li>
<p>å¦‚ä½•æ›¿ä»£å’Œé¿å…</p>
<p>ä¸€èˆ¬æ˜¯æŒæœ‰ä¸€ä¸ª<code>Base *pBase</code>ï¼Œä½†æ˜¯æŒ‡å‘çš„æ˜¯DerivedObjï¼Œäºæ˜¯è½¬å‹ä¸º<code>pDerived</code>ã€‚å¯ä»¥è¿™æ ·ä¿®æ”¹ï¼š</p>
<p>ä¿®æ”¹è®¾è®¡ï¼Œçª„åŒ–ç±»å‹ï¼ŒæŒæœ‰ä¸€ä¸ªpDerivedå³å¯ï¼›æˆ–è€…å°†æƒ³åšçš„äº‹æ”¾åˆ°è™šå‡½æ•°ä¸­ï¼Œåˆ©ç”¨å¤šæ€å»å®Œæˆã€‚</p>
</li>
<li>
<p>é¿å…ä¸²è”</p>
<p>é¿å…ä¸‹æ–¹è¿™æ ·çš„ä»£ç ï¼Œä¸€è¿ä¸²çš„dynamic_castï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Window</span><span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
<span class="c1">// å®šä¹‰å­ç±» SpecialWindow1,SpecalWindow2,SpecialWindow3
</span><span class="c1"></span><span class="n">Window</span><span class="o">*</span> <span class="n">winPtr</span><span class="p">;</span>
<span class="c1">// çœç•¥winPtrçš„å…¶ä»–æ“ä½œ ... 
</span><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="n">SpecialWindow1</span> <span class="o">*</span><span class="n">psw1</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">SpecialWindow1</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">winPtr</span><span class="p">)){</span> <span class="p">...</span> <span class="p">}</span>
<span class="k">else</span>  <span class="nf">if</span><span class="p">(</span><span class="n">SpecialWindow2</span> <span class="o">*</span><span class="n">psw2</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">SpecialWindow2</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">winPtr</span><span class="p">)){</span> <span class="p">...</span> <span class="p">}</span>
<span class="k">else</span>  <span class="nf">if</span><span class="p">(</span><span class="n">SpecialWindow3</span> <span class="o">*</span><span class="n">psw3</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">SpecialWindow3</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">winPtr</span><span class="p">)){</span> <span class="p">...</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·çš„ä»£ç åˆå¤§åˆæ…¢ï¼Œæ¯æ¬¡ç»§æ‰¿ä½“ç³»æœ‰æ‰€æ”¹å˜ï¼Œä»£ç å°±éœ€è¦é‡æ–°æ£€é˜…åˆ¤æ–­ã€‚è¿™æ ·çš„ä»£ç åº”è¯¥ç”¨â€œåŸºäºvirtualå‡½æ•°è°ƒç”¨â€å–ä»£å®ƒã€‚</p>
</li>
</ol>
</li>
</ul>
<div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-info-circle fa-fw"></i>By the way<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>è‡ª <strong>C++11</strong> èµ·ï¼Œé’ˆå¯¹æ™ºèƒ½æŒ‡é’ˆ <code>shared_ptr</code> çš„è½¬å‹ï¼Œæ¨å‡ºäº†å¦å¤– 4 ä¸ªæ¨¡ç‰ˆå‡½æ•°ï¼š</p>
<ul>
<li>
<p><code>std::static_pointer_cast</code></p>
<p>å‡½æ•°çš„åŸå‹å£°æ˜ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">template</span><span class="o">&lt;</span> <span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">U</span> <span class="o">&gt;</span> 
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">static_pointer_cast</span><span class="p">(</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&amp;</span> <span class="n">r</span> <span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>å«ä¹‰ä»¥åŠåº”ç”¨åœºæ™¯ä¸ <code>static_cast</code> ç±»ä¼¼ï¼Œæ¯”å¦‚å­ç±»å‹æŒ‡é’ˆè½¬ä¸ºçˆ¶ç±»å‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">auto</span> <span class="n">basePtr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="p">();</span>
<span class="k">auto</span> <span class="n">derivedPtr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Derived</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">basePtr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">static_pointer_cast</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="p">(</span><span class="n">derivedPtr</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>æˆ–è®¸æˆ‘ä»¬ä¼šæœ‰ç–‘é—®ï¼Œæ˜¯å¦æœ‰å¿…è¦ç”¨è¿™ä¸ªå‡½æ•°è¿›è¡Œè½¬å‹å‘¢ï¼Œå¦‚ä¸‹å®ç°ä¸æ˜¯ä¸€æ ·çš„å—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">basePtr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">derivedPtr</span><span class="p">.</span><span class="n">get</span><span class="p">()));</span>
</code></pre></td></tr></table>
</div>
</div><p>ğŸ¤” <strong>å½“ç„¶ä¸ä¸€æ ·</strong>ï¼Œ<code>static_cast&lt;T*&gt;((U*)nullptr)</code>æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼Œè€Œä¸”å°±è¯­æ³•æè¿°ä¸Šæ¥çœ‹ï¼Œå“ªä¸ªæ›´ç®€æ´ä¸è¨€è‡ªæ˜ã€‚</p>
<p>å¦å¤–ï¼Œè‡ª <strong>C++20</strong> èµ·æ”¯æŒ<strong>å³å€¼å¼•ç”¨</strong>ï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹å½¢å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">template</span><span class="o">&lt;</span> <span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">U</span> <span class="o">&gt;</span> 
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">static_pointer_cast</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&amp;&amp;</span> <span class="n">r</span> <span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>std::dynamic_pointer_cast</code></p>
<p>å«ä¹‰ä»¥åŠåº”ç”¨åœºæ™¯ä¸  dynamic_cast ç±»ä¼¼ï¼Œç”¨æ³•ä¼ å‚ä¸ std::static_pointer_cast ç±»ä¼¼ï¼Œä¸”è‡ª <strong>C++20</strong> èµ·æ”¯æŒå³å€¼å¼•ç”¨ï¼Œä¸èµ˜è¿°ã€‚</p>
</li>
<li>
<p><code>std::const_pointer_cast</code>ï¼šä¸å‰ 2 è€…ç±»ä¼¼ï¼Œä¸èµ˜è¿°ã€‚</p>
</li>
<li>
<p><code>std::reinterpret_pointer_cast</code>ï¼šä¸å‰ 3 è€…ç±»ä¼¼ï¼Œä¸èµ˜è¿°ã€‚</p>
</li>
</ul>
</div>
        </div>
    </div>
<hr>
<h2 id="r28-é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†">R28 é¿å…è¿”å›handlesæŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†</h2>
<p>è¿™é‡Œçš„<strong>handlesï¼ˆå·ç ç‰Œï¼‰åŒ…æ‹¬</strong>æŒ‡å‘å¯¹è±¡å†…éƒ¨çš„<strong>æŒ‡é’ˆ</strong>ã€<strong>è¿­ä»£å™¨</strong>ã€<strong>å¼•ç”¨</strong>ã€‚</p>
<p>ä»¥ä¸‹è®²è¿°å½“è¿”å›å¯¹è±¡å†…éƒ¨çš„handlesæ—¶ï¼Œå­˜åœ¨çš„2ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>
<p>å¯èƒ½ä¼šç ´åå°è£…æ€§</p>
<p>è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼špublicå‡½æ•°è¿”å›ä¸€ä¸ªprivateæˆå‘˜çš„éconstå¼•ç”¨ï¼Œå°±è®©å¤–ç•Œæœ‰äº†ä¿®æ”¹privateçš„æœºä¼šï¼Œç ´åäº†å°è£…æ€§ã€‚</p>
<p>æ­¤æ—¶ï¼Œéœ€è¦å°†éconstå¼•ç”¨æ”¹ä¸ºconstå¼•ç”¨ï¼Œåªè¯»å±æ€§ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">struct</span> <span class="nc">Pixel</span><span class="p">{</span>
    <span class="kt">float</span> <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">Image</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>  <span class="c1">//æ³¨æ„ï¼šåé¢è¿™conståªä¿è¯æˆå‘˜å˜é‡vPixPtrs_ä¸æ”¹
</span><span class="c1"></span>    <span class="n">Pixel</span><span class="o">&amp;</span> <span class="n">GetThePixel</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span>  
        <span class="k">return</span>  <span class="n">vPixPtrs_</span><span class="p">[</span><span class="n">i</span><span class="p">];}</span><span class="c1">//éšæ‚£ï¼šå…¶å®å¤–éƒ¨è°ƒç”¨è€…ä»èƒ½ç›´æ¥ä¿®æ”¹Pixelçš„rgbå€¼
</span><span class="c1"></span>    <span class="c1">// ä¸Šä¸€å¥çš„è¿”å›å€¼åº”è¯¥æ”¹ä¸º &#34;const Pixel&amp;&#34;
</span><span class="c1"></span><span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Pixel</span><span class="o">&gt;&gt;</span> <span class="n">vPixPtrs_</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å¯èƒ½ä¼šå¼•èµ·â€œç©ºæ‚¬handlesâ€</p>
<p>å³ä½¿ç”¨constè§£å†³äº†å°è£…æ€§çš„é—®é¢˜ï¼Œå› ä¸ºå¾ˆå®¹æ˜“å‡ºç°â€œ<strong>handlesæ¯”å…¶æ‰€æŒ‡å¯¹è±¡æ›´é•¿å¯¿</strong>â€ï¼Œå¯èƒ½å­˜åœ¨å¯¹è±¡å·²ææ„ï¼Œä½†handlesè¿˜ç•™å­˜çš„é—®é¢˜ã€‚å°¤å…¶æ˜¯ä¸´æ—¶å˜é‡çš„ææ„ï¼Œä¸å¤ªå®¹æ˜“å¯Ÿè§‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">SceneGraph</span><span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
<span class="k">const</span> <span class="n">Image</span> <span class="nf">CaptureImage</span><span class="p">(</span><span class="k">const</span> <span class="n">SceneGraph</span><span class="o">&amp;</span> <span class="n">graph</span><span class="p">);</span>
<span class="c1">//é‚£ä¹ˆè°ƒç”¨æ–¹å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨
</span><span class="c1"></span><span class="n">SceneGraph</span> <span class="n">Grap</span><span class="p">;</span>
<span class="c1">//ä¸‹é¢è¿™å¥ä¹‹åï¼ŒImageä¸´æ—¶å¯¹è±¡è¢«é”€æ¯ï¼ŒpPixæŒ‡å‘ä¸€ä¸ªä¸å­˜åœ¨çš„å¯¹è±¡
</span><span class="c1"></span><span class="k">const</span> <span class="n">Pixel</span> <span class="o">*</span><span class="n">pPix</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">CaptureImage</span><span class="p">(</span><span class="n">Grap</span><span class="p">).</span><span class="n">GetThePixel</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼ŒCaptureImageçš„ç¡®èƒ½è¿”å›ä¸€ä¸ªä¸´æ—¶Imageå¯¹è±¡ï¼Œèƒ½æˆåŠŸè°ƒç”¨GetThePixelï¼Œä½†è¿™å¥ç»“æŸåï¼Œä¸´æ—¶å¯¹è±¡ç«‹é©¬ä¼šè¢«é”€æ¯ï¼Œé€ æˆç©ºæ‚¬ç°è±¡ï¼Œæˆ–å«è™šåŠ(dangling) ï¼</p>
</li>
</ul>
<hr>
<h2 id="r29-ä¸ºå¼‚å¸¸å®‰å…¨è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„">R29 ä¸ºâ€œå¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„</h2>
<p>â€œ<strong>å¼‚å¸¸å®‰å…¨</strong>â€æ˜¯æŒ‡ï¼Œå½“å¼‚å¸¸æŠ›å‡ºæ—¶ï¼Œä»£ç ä¾ç„¶èƒ½åšåˆ°å¦‚ä¸‹2ç‚¹ï¼š</p>
<ol>
<li>
<p>ä¸æ³„éœ²ä»»ä½•èµ„æº</p>
<p>åŒ…æ‹¬å†…å­˜èµ„æºï¼Œé”èµ„æºã€‚</p>
</li>
<li>
<p>ä¸å…è®¸æ•°æ®è´¥å</p>
<p>ä¸ä¼šå› ä¸ºå¼‚å¸¸è€Œå¯¼è‡´ç©ºæ‚¬æŒ‡é’ˆç­‰æœªå®šä¹‰è¡Œä¸ºã€‚</p>
</li>
</ol>
<p>è€ƒè™‘ä¸‹æ–¹çš„ç¤ºä¾‹ä»£ç ï¼Œï¼ˆå¦‚æœ<code>new Image</code>æŠ›<code>std::bad_alloc</code>å¼‚å¸¸ï¼‰åˆ™ä¼šåŒæ—¶è¿èƒŒäº†ä¸Šè¿°2æ¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">PrettyMenu</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">Mutex</span> <span class="n">mutex_</span><span class="p">;</span> <span class="c1">//äº’æ–¥å™¨
</span><span class="c1"></span>    <span class="n">Image</span><span class="o">*</span> <span class="n">bgImage_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">imageChangeCnt_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
	<span class="kt">void</span> <span class="n">PrettyMenu</span><span class="o">::</span><span class="n">changeBackground</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="o">&amp;</span> <span class="n">imgSrc</span><span class="p">){</span>
        <span class="n">lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_</span><span class="p">);</span><span class="c1">// è¿™ä¸ªå¯ä»¥æ”¹ä¸ºRAIIçš„é”ï¼Œæ¥ä¿è¯å¼‚å¸¸å®‰å…¨
</span><span class="c1"></span>        <span class="k">delete</span> <span class="n">bgImage_</span><span class="p">;</span>
        <span class="o">++</span><span class="n">imageChangeCnt_</span><span class="p">;</span>
        <span class="c1">//è¿™é‡Œnew ImageæŠ›å¼‚å¸¸ï¼Œå¯¼è‡´æ— æ³•è§£é”ï¼›ä¸”bgImage_æŒ‡å‘èµ„æºå·²ç»é‡Šæ”¾ï¼Œç©ºæ‚¬æŒ‡é’ˆ
</span><span class="c1"></span>        <span class="n">bgImage_</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Image</span><span class="p">(</span><span class="n">imageSrc_</span><span class="p">);</span>
        <span class="n">unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="å¼‚å¸¸å®‰å…¨çš„3ä¸ªç­‰çº§">å¼‚å¸¸å®‰å…¨çš„3ä¸ªç­‰çº§</h3>
<p>å¼‚å¸¸å®‰å…¨çš„å‡½æ•°ï¼Œæœ‰<strong>3ä¸ªç­‰çº§</strong>çš„å¼‚å¸¸å®‰å…¨ä¿è¯ï¼Œä¼šæ»¡è¶³<strong>ä¸‰è€…ä¹‹ä¸€</strong>ï¼š</p>
<ul>
<li>
<p><strong>åŸºæœ¬æ‰¿è¯º</strong></p>
<p>å¦‚æœå¼‚å¸¸è¢«æŠ›å‡ºï¼Œç¨‹åºå†…çš„ä»»ä½•äº‹åŠ¡ä»ç„¶ä¿æŒåœ¨æœ‰æ•ˆçŠ¶æ€ä¸‹ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•æ•°æ®è´¥åã€‚æ¯”å¦‚ä¸Šä¾‹ä¸­å¦‚æœæŠ›å¼‚å¸¸ï¼Œä¼šå¦å¤–æ·»åŠ å®ç°ï¼Œä½¿bgImage_æŒæœ‰æŸä¸ªé»˜è®¤å›¾åƒï¼Œæˆ–ä¿æŒåŸå€¼ï¼Œè®©ç¨‹åºç»§ç»­<strong>æœ‰æ•ˆè¿è¡Œ</strong>ã€‚</p>
</li>
<li>
<p><strong>å¼ºçƒˆä¿è¯</strong></p>
<p>å¦‚æœå¼‚å¸¸è¢«æŠ›å‡ºï¼Œç¨‹åºçŠ¶æ€ä¸æ”¹å˜ã€‚è¿™æ ·çš„å‡½æ•°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆé€€å›åˆ°æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚</p>
<p>ä¸Šè¿°æ¡ˆä¾‹åˆ™åº”è¯¥ä¼šè¢«ä¿®æ”¹æˆå¦‚ä¸‹å½¢å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">PrettyMenu</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Image</span><span class="o">&gt;</span> <span class="n">bgImage_</span><span class="p">;</span> <span class="c1">//RAIIé¿å…äº†å¼‚å¸¸å‘ç”Ÿæ—¶çš„èµ„æºæ³„æ¼å’Œæ•°æ®è´¥å
</span><span class="c1"></span>    <span class="c1">//... çœç•¥å…¶ä»–æˆå‘˜
</span><span class="c1"></span><span class="k">public</span><span class="o">:</span>
	<span class="kt">void</span> <span class="n">PrettyMenu</span><span class="o">::</span><span class="n">changeBackground</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="o">&amp;</span> <span class="n">imgSrc</span><span class="p">){</span>
        <span class="n">CLock</span> <span class="nf">ml</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_</span><span class="p">);</span><span class="c1">//RAIIå°è£…çš„Lockç±»ï¼Œè¯¦ç»†å¯å‚è€ƒ é˜…è¯»æ€»ç»“(äºŒ)-Rule14
</span><span class="c1"></span>        <span class="n">bgImage_</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span> <span class="n">Image</span><span class="p">(</span><span class="n">imgSrc</span><span class="p">));</span><span class="c1">//è‹¥newå¤±è´¥ï¼Œåˆ™ä¸ä¼šreset
</span><span class="c1"></span>        <span class="o">++</span><span class="n">imageChangeCnt_</span><span class="p">;</span><span class="c1">//æŠŠäº‹æƒ…åšå®Œå†++count
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>ä¸æŠ›å¼‚å¸¸</strong></p>
<p>åœ¨åŸä¹¦ä¸­ï¼Œè¿™ä¸ªâ€œNo Throwâ€ä¸æ˜¯ç»å¯¹ä¸æŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯ä¸€æ—¦æ„å¤–æŠ›å¼‚å¸¸ï¼Œå°±ä¼šè°ƒç”¨unexpectedå‡½æ•°è¿›è€Œabortï¼ˆä¾‹å¦‚<code>int doSomething()  throw();//ç©ºç™½çš„å¼‚å¸¸æ˜ç»†</code>ï¼‰ã€‚</p>
<div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-info-circle fa-fw"></i>By the way<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li>
<p>åŸä¹¦ä¸­ä¾‹å­çš„ <strong>throw()</strong> åœ¨ä¸åŒç¼–è¯‘å™¨è¡¨ç°ä¸ä¸€è‡´ï¼Œç°åœ¨å·²ç» <strong>ä¸æ¨èä½¿ç”¨</strong>ã€‚</p>
<p>æ›´è¯¦ç»†èµ„æ–™å¯å‚è€ƒ<a href="http://gotw.ca/publications/mill22.htm" target="_blank" rel="noopener noreffer">A Pragmatic Look at Exception Specifications</a>å’Œ<a href="https://stackoverflow.com/questions/88573/should-i-use-an-exception-specifier-in-c" target="_blank" rel="noopener noreffer">Should I use an exception specifier in C++</a></p>
</li>
<li>
<p>åœ¨C++11ä¸­ï¼Œæœ‰äº†æ›´å¯é æœ‰æ•ˆçš„å…³é”®å­—<code>noexcept</code>ï¼Œä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œæœ‰æ“ä½œç¬¦å’Œå¼‚å¸¸æç¤ºç¬¦ä¸¤ç§ä½œç”¨ï¼Œä¸‹æ–¹å±•ç¤ºç®€å•ç”¨æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">f</span><span class="p">()</span> <span class="k">noexcept</span><span class="p">;</span> <span class="c1">// å‡½æ•° f() ä¸ä¼šæŠ›å‡º
</span><span class="c1"></span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fp</span><span class="p">)()</span> <span class="k">noexcept</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span> <span class="c1">// fp æŒ‡å‘å¯èƒ½ä¼šæŠ›å‡ºçš„å‡½æ•°
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">g</span><span class="p">(</span><span class="kt">void</span> <span class="n">pfa</span><span class="p">()</span> <span class="k">noexcept</span><span class="p">);</span>  <span class="c1">// g æ¥æ”¶æŒ‡å‘ä¸ä¼šæŠ›å‡ºçš„å‡½æ•°çš„æŒ‡é’ˆ
</span><span class="c1">// typedef int (*pf)() noexcept; // é”™è¯¯
</span></code></pre></td></tr></table>
</div>
</div><p>æ›´è¯¦ç»†çš„<code>noexcept</code>ä»‹ç»å¯ä»¥è®¿é—®<a href="https://zh.cppreference.com/w/cpp/language/noexcept" target="_blank" rel="noopener noreffer">cppreferenceï¼šnoexceptæ“ä½œç¬¦</a>å’Œ<a href="https://zh.cppreference.com/w/cpp/language/noexcept_spec" target="_blank" rel="noopener noreffer">cppreferenceï¼šnoexceptå¼‚å¸¸è¯´æ˜ç¬¦</a></p>
</li>
</ul>
</div>
        </div>
    </div>
</li>
</ul>
<h3 id="ä½¿ç”¨copy-and-swapä¿éšœå¼‚å¸¸å®‰å…¨">ä½¿ç”¨copy-and-swapä¿éšœå¼‚å¸¸å®‰å…¨</h3>
<p><code>copy-and-swap</code>æŠ€æœ¯ï¼š<strong>å…ˆæ‹·è´ä¸€ä»½æƒ³ä¿®æ”¹çš„å¯¹è±¡ï¼Œç­‰ä¿®æ”¹å½»åº•å®Œæˆåï¼ˆè¿‡ç¨‹ä¸­ä¸æŠ›å¼‚å¸¸ï¼‰ï¼Œå†ä¸åŸå¯¹è±¡äº¤æ¢</strong>ã€‚</p>
<p>ä¸ºäº†æ›´å½¢è±¡å±•ç¤ºè¿™ä¸€è¿‡ç¨‹ï¼Œä½¿ç”¨pImlæ‰‹æ³•å¯¹bgImage_å°è£…ä¸€ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">struct</span> <span class="nc">ImgPimpl</span><span class="p">{</span> <span class="c1">//é€‰ç”¨structè€ŒéClassï¼šæ–¹ä¾¿ï¼›æœ€åè¢«privateæˆå‘˜å½¢å¼ä½¿ç”¨ï¼Œå°è£…æ€§ä¸ç”¨æ‹…å¿ƒ
</span><span class="c1"></span>   <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Image</span><span class="o">&gt;</span> <span class="n">bgImage_</span><span class="p">;</span>
   <span class="kt">int</span> <span class="n">imageChangeCnt_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆPrettyMenuç±»å¯ä»¥æ”¹ä¸ºå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">PrettyMenu</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">Mutex</span> <span class="n">mutex_</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ImgPimpl</span><span class="o">&gt;</span> <span class="n">pImpl_</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>  <span class="c1">//æ„é€ ç•¥
</span><span class="c1"></span>	<span class="kt">void</span> <span class="n">PrettyMenu</span><span class="o">::</span><span class="n">changeBackground</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="o">&amp;</span> <span class="n">imgSrc</span><span class="p">){</span>
        <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>   <span class="c1">//å‚è€ƒ é˜…è¯»æ€»ç»“(äºŒ)-Rule25
</span><span class="c1"></span>        <span class="n">CLock</span> <span class="nf">ml</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex_</span><span class="p">);</span><span class="c1">//RAIIå°è£…çš„Lockç±»ï¼Œè¯¦ç»†å¯å‚è€ƒæ€»ç»“(äºŒ)-Rule14
</span><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ImgPimpl</span><span class="o">&gt;</span> <span class="n">pNewCopy</span><span class="p">(</span><span class="k">new</span> <span class="n">ImgPimpl</span><span class="p">(</span><span class="o">*</span><span class="n">pImpl_</span><span class="p">));</span>
        <span class="n">pNewCopy</span><span class="o">-&gt;</span><span class="n">bgImage_</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span> <span class="n">Image</span><span class="p">(</span><span class="n">imgSrc</span><span class="p">));</span> <span class="c1">//ä¿®æ”¹å‰¯æœ¬
</span><span class="c1"></span>        <span class="o">++</span><span class="n">pNewCopy</span><span class="o">-&gt;</span><span class="n">imageChangeCnt_</span><span class="p">;</span> 
        
        <span class="n">swap</span><span class="p">(</span><span class="n">pImpl_</span><span class="p">,</span><span class="n">pNewCopy</span><span class="p">);</span><span class="c1">//æ”¹å®Œä¹‹åswap
</span><span class="c1"></span>    <span class="p">}</span>    
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="å¼‚å¸¸å®‰å…¨çš„è¿å¸¦å½±å“side-effects">å¼‚å¸¸å®‰å…¨çš„è¿å¸¦å½±å“(side effects)</h3>
<p>å‡½æ•°æä¾›çš„â€œå¼‚å¸¸å®‰å…¨ä¿è¯ç­‰çº§â€åª<strong>å–å†³äº</strong>å…¶è°ƒç”¨çš„<strong>å„ä¸ªå­å‡½æ•°çš„â€œæœ€ä¸å®‰å…¨è€…â€</strong>ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹å‡½æ•°SomeFuncä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="n">SomeFunc</span><span class="p">{</span>
    <span class="p">...</span> <span class="c1">// å¯¹localçŠ¶æ€åšä¸€ä»½å‰¯æœ¬
</span><span class="c1"></span>    <span class="n">f1</span><span class="p">();</span>
    <span class="n">f2</span><span class="p">();</span>
    <span class="p">...</span>  <span class="c1">//å°†ä¿®æ”¹åçš„çŠ¶æ€ç½®æ¢è¿‡æ¥
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>åˆ†æ</code>ï¼šæ˜¾ç„¶copy-and-swapåœ¨å°½åŠ›å¼ºçƒˆä¿è¯å¼‚å¸¸å®‰å…¨ï¼Œä½†æ˜¯ï¼Œf1æˆ–è€…f2çš„å¼‚å¸¸å®‰å…¨å¦‚æœæ¯”è¾ƒä½ï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦å•ç‹¬å¯¹f1ï¼Œf2è¿›è¡Œcopy-and-swapï¼Œæ¥å°è¯•ä¿è¯â€œå¼ºçƒˆå¼‚å¸¸å®‰å…¨â€ï¼›å³ä½¿å¦‚æ­¤ï¼Œå¦‚æœf1èƒ½æˆåŠŸåšäº†ä¿®æ”¹ï¼Œä½†æ˜¯f2ä¿®æ”¹å¤±è´¥äº†å¹¶å›é€€ï¼Œé‚£ä¹ˆ<strong>f1ã€f2æ•´ä½“</strong>çœ‹èµ·æ¥è¿˜æ˜¯â€œ<strong>æ”¹äº†ä¸€éƒ¨åˆ†</strong>â€ã€‚</p>
<p><strong><code>è¿™ä¹Ÿå‘Šè¯«æˆ‘ä»¬</code></strong>ï¼Œå¦‚æœå¼•å…¥äº†å¼‚å¸¸ä¸å®‰å…¨çš„æ—§ä»£ç ï¼Œé‚£ä¹ˆè¿™ç§ç‰¹æ€§ä¼šæ³¢åŠå…¶ä»–ä»£ç ã€‚</p>
<p>å°±è®¾è®¡è€…è€Œè¨€ï¼Œåªèƒ½æ ¹æ®å®é™…æƒ…å†µï¼Œå°½å¯èƒ½ä¿è¯â€œå¼‚å¸¸å®‰å…¨â€ï¼Œé€‰æ‹©3ä¸ªå¼‚å¸¸å®‰å…¨ç­‰çº§ä¹‹ä¸€å®æ–½ã€‚</p>
<hr>
<h2 id="r30-é€å½»äº†è§£inlineçš„é‡Œé‡Œå¤–å¤–">R30 é€å½»äº†è§£inlineçš„é‡Œé‡Œå¤–å¤–</h2>
<p><code>inline</code>æ˜¯C++çš„å…³é”®å­—ï¼Œè¡¨ç¤ºå†…è”å‡½æ•°ã€‚<code>ç›´æ¥åœ¨å¯¹åº”ä½ç½®å±•å¼€ä»£ç </code>ï¼Œå…å»å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼Œéš¾ä»¥é¿å… â€œ<strong>ä»£ç è†¨èƒ€</strong>â€é—®é¢˜ã€‚</p>
<p>ä½¿ç”¨inlineæ—¶åº”è¯¥æ³¨æ„ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>
<p><strong>inlineåªæ˜¯å¯¹ç¼–è¯‘å™¨çš„ç”³è¯·</strong></p>
<p>inlineåªæ˜¯å¯¹ç¼–è¯‘å™¨çš„ç”³è¯·/å»ºè®®ï¼Œä¸æ˜¯å¼ºåˆ¶å‘½ä»¤ï¼Œ<strong>ç¼–è¯‘å™¨æœ‰æƒåˆ©</strong> å¯¹å…¶è®¤ä¸ºä¸é€‚åˆinlineçš„å‡½æ•°<strong>æ‹’ç»</strong>inlineã€‚ ï¼ˆåŸä¹¦è¯´ï¼šå¦‚æœç¼–è¯‘å™¨æ‹’ç»ï¼Œé€šå¸¸å®ƒä¼šç»™å‡ºwarningä¿¡æ¯ã€‚å®é™…æœ¬äººå®æµ‹VS2017æ²¡çœ‹åˆ°ï¼‰</p>
<p><em>inlineæœ‰2ç§ç”³è¯·æ–¹å¼</em> ï¼š</p>
<ol>
<li>åœ¨<em>å‡½æ•°å®šä¹‰</em> æ—¶ä½¿ç”¨å…³é”®å­—inline<strong>æ˜¾å¼å¼ºè°ƒ</strong></li>
<li>å®ç°åœ¨Classå†…çš„æˆå‘˜å‡½æ•°æˆ–friendå‡½æ•°ï¼Œå±äº<strong>éšå¼inline</strong></li>
</ol>
</li>
<li>
<p><strong>inlineå’ŒTemplateæ²¡æœ‰ä»»ä½•å¿…ç„¶è”ç³»</strong></p>
<p>è™½ç„¶æœ‰ä¸å°‘ç®€çŸ­çš„Templateå‡½æ•°æ˜¯å¸¦æœ‰inlineï¼ˆä¾‹å¦‚ä¸‹æ–¹çš„<code>std::max</code>ï¼‰ï¼Œä½†ä¸æ˜¯å¿…ç„¶ä¸ºä¹‹ï¼Œ<strong>ä¸¤è€…æ²¡æœ‰å› æœå…³ç³»</strong>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">){</span> <span class="c1">//å¯ä»¥ç”³è¯·inlineï¼Œä½†ä¸æ˜¯å¿…é¡»ç”³è¯·
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="o">?</span> <span class="nl">b</span> <span class="p">:</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>ç¼–è¯‘å™¨æ‹’ç»å¤æ‚å‡½æ•°è¿›è¡Œinline</strong></p>
<p>å¤æ‚å‡½æ•°çš„inlineä¼šå¸¦æ¥è¾ƒä¸¥é‡çš„â€œä»£ç è†¨èƒ€â€é—®é¢˜ï¼Œå¹¶ä¸”å¯èƒ½ä¼šæ›´æ…¢ï¼Œå› ä¸ºå¢åŠ äº†è¿è¡Œæ—¶çš„â€œé¢å¤–æ¢é¡µâ€è¡Œä¸ºï¼Œé™ä½äº†æŒ‡ä»¤cacheå‘½ä¸­ç‡ã€‚</p>
<ol>
<li>
<p><em>inlineå‡½æ•°å†…ä¸è¦å‡ºç°å¾ªç¯æˆ–é€’å½’</em></p>
</li>
<li>
<p>è™šå‡½æ•°ä¹Ÿä¸é€‚åˆåšinline</p>
<p>å› ä¸ºinlineæ˜¯ç¼–è¯‘æœŸé—´å†³å®šçš„äº‹ï¼Œè€Œè™šå‡½æ•°æ˜¯è¿è¡Œæ—¶å†³å®šçš„äº‹ï¼Œä¸¤è€…å°±ä¸æ˜¯åŒä¸€ä¸ªåœºæ™¯çš„ã€‚</p>
</li>
<li>
<p><em>æ„é€ /ææ„å‡½æ•°ä¹Ÿä¸é€‚åˆåšinline</em></p>
</li>
</ol>
<p>â€‹        ç¼–è¯‘å™¨å¯èƒ½ä¼šåœ¨æ„é€ /ææ„å‡½æ•°å†…éƒ¨åšç²¾å¦™å¤æ‚çš„å¼‚å¸¸å¤„ç†ï¼›ä»¥åŠåœ¨ç»§æ‰¿ä½“ç³»ä¸‹ï¼ŒBaseç±»å‡½æ•°ä½“åˆ°å¤„inlineè†¨èƒ€ã€‚</p>
</li>
<li>
<p><strong>ä»¥å‡½æ•°æŒ‡é’ˆå½¢å¼çš„è°ƒç”¨é€šå¸¸ä¸èƒ½inline</strong></p>
<p>å¯¹ç»å¤§å¤šæ•°ç¼–è¯‘å™¨è€Œè¨€ï¼Œæ˜¯å¦inlineæ˜¯compileé˜¶æ®µå†³å®šçš„äº‹æƒ…ï¼Œå°‘æ•°ç¼–è¯‘å™¨æ”¾åˆ°äº†linké˜¶æ®µã€‚</p>
<p>è®¨è®ºå¤§å¤šæ•°æƒ…å†µï¼šéœ€è¦åœ¨ç¼–è¯‘æ—¶å¾—çŸ¥inlineçš„æœ¬ä½“ï¼Œè€Œå‡½æ•°æŒ‡é’ˆåŠä¸åˆ°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kr">inline</span> <span class="kt">void</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{...}</span> <span class="c1">//å‡è®¾ç¼–è¯‘å™¨æœ‰æ„æ„¿inline â€œå¯¹fçš„è°ƒç”¨â€
</span><span class="c1"></span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span> <span class="n">pf</span><span class="p">)()</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span><span class="c1">//pf æ‰§è¡Œf
</span><span class="c1"></span><span class="p">...</span>
<span class="n">f</span><span class="p">();</span>     <span class="c1">//è¿™ä¸ªè°ƒç”¨å°†è¢«inlinedï¼Œå› ä¸ºæ˜¯ä¸ªæ­£å¸¸è°ƒç”¨
</span><span class="c1"></span><span class="n">pf</span><span class="p">();</span>     <span class="c1">//è¿™ä¸ªå¾ˆå¯èƒ½ä¸è¢«inlined
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>è¿‡åº¦inlineå¯¹è°ƒè¯•å’Œå‘å¸ƒå¸¦æ¥å›°éš¾</strong></p>
<p>inlineæ˜¯ä»£ç åµŒå…¥ä¸å±•å¼€ï¼Œè€Œéå‡½æ•°è°ƒç”¨ï¼Œæ‰€ä»¥æŸäº›ç¼–è¯‘å™¨ä¸æ”¯æŒinlineçš„å•æ­¥Debugï¼ˆå°±åƒå®å±•å¼€ä¸€æ ·ä¸æ”¯æŒè°ƒè¯•ï¼‰ï¼›å¦å¤–ï¼Œinlineåªè¦å·²ä¿®æ”¹ï¼Œæ¶‰åŠè°ƒç”¨å®ƒçš„ä»£ç å…¨éƒ½è¦ç¼–è¯‘ï¼Œå¦‚æœæ˜¯non-inlineåˆ™å¯èƒ½åªéœ€è¦é‡æ–°linkå³å¯ã€‚</p>
</li>
</ul>
<hr>
<h2 id="r31-å°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾èµ–å…³ç³»é™è‡³æœ€ä½">R31 å°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾èµ–å…³ç³»é™è‡³æœ€ä½</h2>
<p>C++çš„Classå®šä¹‰å¼åŒ…æ‹¬äº†æˆå‘˜å˜é‡ï¼Œå‡è®¾æŸæˆå‘˜å˜é‡æ˜¯ç±»å¯¹è±¡<code>ClassObjA a</code>ï¼Œå¦‚æœClassObjAç±»çš„å†…éƒ¨å®ç°å‘ç”Ÿäº†æ”¹å˜ï¼ˆ<em>å“ªæ€•è¿™ä¸ª<code>ClassObjA.h</code>å†…åªåœ¨æŸå¤„åŠ äº†ä¸€ä¸ªç©ºæ ¼</em> ï¼‰ï¼Œé‚£ä¹ˆincludeäº†<code>ClassObjA.h</code>çš„æ‰€æœ‰.hæ–‡ä»¶.cppæ–‡ä»¶éƒ½ä¼š<strong>é‡æ–°ç¼–è¯‘</strong>ã€‚</p>
<p>ğŸ‘†è¿™å°±æ˜¯ç”±â€œ<strong>ç¼–è¯‘ä¾èµ–</strong>â€å…³ç³»å¸¦æ¥çš„é—®é¢˜ã€‚</p>
<p>ä½¿ç”¨ <strong><code>PIMPL</code></strong> æ‰‹æ³•(pointer to implementation)å¯ä»¥å¾ˆå¥½åœ°åˆ†ç¦»å£°æ˜å’Œå®šä¹‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">//Person.hæ–‡ä»¶  ä¸éœ€è¦include &#34;PersonImpl.h&#34;å’Œ&#34;BirthDay.h&#34;
</span><span class="c1"></span><span class="k">class</span> <span class="nc">PersonImpl</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">BirthDay</span><span class="p">;</span><span class="c1">// å‰ç½®å£°æ˜ä»£æ›¿include
</span><span class="c1"></span><span class="k">class</span> <span class="nc">Person</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span><span class="c1">// æ„é€ å‡½æ•°è¿™é‡Œæ”¾å®ç°æ— æ‰€è°“ï¼Œå› ä¸ºæ˜¯å‡½æ•°æŒ‡é’ˆï¼Œä¸éœ€çŸ¥é“PersonImplæœ¬ä½“å®ç°
</span><span class="c1"></span>    <span class="n">Person</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">PersonImpl</span><span class="o">&gt;&amp;</span> <span class="n">pImpl</span><span class="p">);</span><span class="c1">//æ„é€ å‡½æ•°çš„å®ç°ä¹Ÿæ”¾åˆ°cppé‡Œå»
</span><span class="c1"></span>    <span class="k">const</span> <span class="n">BirthDay</span><span class="o">&amp;</span> <span class="n">GetBirthDay</span><span class="p">();</span><span class="c1">// æ³¨æ„ï¼šè¿™é‡Œåªå£°æ˜ï¼ŒæŠŠå®ç°éƒ¨åˆ†æ”¾åˆ°cppé‡Œ
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetName</span><span class="p">();</span><span class="c1">//å®ç°ç»†èŠ‚ç”±pImpl_è½¬å‘å®ç°
</span><span class="c1"></span><span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">PersonImpl</span><span class="o">&gt;</span> <span class="n">pImpl_</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//Person.cppæ–‡ä»¶  
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&#34;PersonImpl.h&#34; //åœ¨&#34;PersonImpl.h&#34;æ–‡ä»¶å†…includeé‚£ä¸ª&#34;BirthDay.h&#34;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;Person.h&#34;</span><span class="cp">
</span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼š<em>Implç”¨æ³•ï¼Œç›¸å…³çš„å¤´æ–‡ä»¶é‡Œä¸è¦æ”¾ç½®ä»»ä½•å‡½æ•°å®ç°ä»£ç </em> ã€‚</p>
<p>ä¸Šè¿°åšæ³•å¯ä»¥è®©ä½¿ç”¨Personç±»çš„å®¢æˆ·ä¸éœ€è¦å†å…³å¿ƒPersonImplä»¥åŠBirthDayçš„å®ç°ç»†èŠ‚äº†ï¼Œåšåˆ°äº†â€œæ¥å£ä¸å®ç°åˆ†ç¦»â€ï¼Œå…³é”®ç‚¹åœ¨äºæŠŠâ€œå®šä¹‰çš„ä¾èµ–æ€§â€ æ¢æˆ $\Rightarrow$ â€œ<strong>å£°æ˜çš„ä¾èµ–æ€§</strong>â€ã€‚</p>
<p>è¿™é‡Œçªå‡ºäº†å¦‚ä½•<strong>æœ€å°åŒ–ç¼–è¯‘ä¾èµ–</strong>æ€§çš„æœ¬è´¨ï¼š<code>è®©å¤´æ–‡ä»¶å°½å¯èƒ½è‡ªæˆ‘æ»¡è¶³</code>ï¼Œå¦‚æœä¸è¡Œï¼Œä¹Ÿè¦ä¾èµ–äºå…¶ä»–æ–‡ä»¶çš„å£°æ˜å¼è€Œéå®šä¹‰å¼ã€‚</p>
<p>å…·ä½“åˆ°è®¾è®¡ç­–ç•¥ä¸Šï¼Œæœ‰ä»¥ä¸‹å‡ ç§åšæ³•ï¼š</p>
<ul>
<li>
<p>å¦‚æœèƒ½ç”¨object references æˆ– object pointerså®Œæˆä»»åŠ¡ï¼Œå°±åˆ«ç”¨objects</p>
<p>å¦‚æœè¦å®šä¹‰æŸç±»å‹çš„objectsï¼Œå°±è¦ä½¿ç”¨å®šä¹‰å¼ï¼ŒæŒ‡é’ˆå’Œåº”ç”¨åˆ™å¯ä»¥åªç”¨å£°æ˜å¼ã€‚</p>
</li>
<li>
<p>å°½é‡ä»¥classå£°æ˜å¼æ›¿æ¢classå®šä¹‰å¼</p>
<p>å‡½æ•°å£°æ˜ç§çš„Classç±»å‹å¯ä»¥åªç”¨å£°æ˜å¼ï¼Œå³ä½¿ä»¥by-object-valueå½¢å¼ä¼ å€¼ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
</li>
<li>
<p>ä¸ºå£°æ˜å¼å’Œå®šä¹‰å¼æä¾›ä¸åŒçš„æ–‡ä»¶</p>
<p>æ¯”å¦‚Dateç±»ï¼Œåˆ†ä¸ºåªåŒ…å«å£°æ˜å¼çš„&quot;Datefwd.h&quot;å’ŒåŒ…å«å®šä¹‰å¼çš„&quot;Date.h&quot;ï¼Œé‚£ä¹ˆä½¿ç”¨æ—¶ç”¨å£°æ˜å¼å¤´æ–‡ä»¶ä»£æ›¿å‰ç½®å£°æ˜ï¼Œåœ¨éœ€è¦åº”ç”¨ä»£ç client.cppé‡Œincludeå®šä¹‰å¼å¤´æ–‡ä»¶ã€‚è¿™ç§æ–¹å¼åœ¨<strong>æ ‡å‡†åº“é‡Œé‡‡ç”¨è¾ƒå¤š</strong>ï¼Œå‚è€ƒ&lt;iosfwd&gt;å’Œ&lt;sstream&gt;,&lt;fstream&gt;,&lt;streambuf&gt;ç­‰ã€‚</p>
</li>
</ul>
<div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-info-circle fa-fw"></i>By the way<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li>
<p>C/C++å¯ä»¥ä½¿ç”¨ç¼–è¯‘å™¨é¢„å¤„ç†æŒ‡ä»¤<code>#pragma message</code>ï¼Œæ‰“å°å‡ºè¯¥æ–‡ä»¶æ˜¯å¦å‚ä¸æ­¤æ¬¡ç¼–è¯‘ï¼Œä»¥åŠå‚ä¸ç¼–è¯‘æ—¶è¢«å“ªä¸ªæ–‡ä»¶æ‰€ä¾èµ–ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">//æ¯”å¦‚å¯ä»¥åœ¨ testEffective.h æ–‡ä»¶å†…åŠ ä¸Šè¿™å¥ï¼Œå°±èƒ½åœ¨ç¼–è¯‘è¾“å‡ºä¿¡æ¯é‡Œçœ‹åˆ°æ‰“å°ä¿¡æ¯ï¼Œè§‚å¯Ÿåˆ°ä¾èµ–å…³ç³»
</span><span class="c1"></span><span class="cp">#pragma message(&#34;testEffective.h å‚ä¸é‡æ–°ç¼–è¯‘&#34;)
</span><span class="cp"></span><span class="c1">//è¿˜å¯ä»¥ç”¨äºæµ‹è¯•æŸäº›å®æ˜¯å¦çœŸçš„ç”Ÿæ•ˆï¼Œæœ‰æ—¶IDEçš„é«˜äº®æ˜¾ç¤ºä¸å‡†ç¡®è€Œä»¤äººç”Ÿç–‘ã€‚
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å…³äºå¤´æ–‡ä»¶includeçš„å…¶ä»–ç¼–å†™è§„èŒƒï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/headers/#" target="_blank" rel="noopener noreffer"><em>Google-C++é£æ ¼æŒ‡å—ï¼š1.å¤´æ–‡ä»¶</em></a></p>
</li>
</ul>
</div>
        </div>
    </div>
<p>ä½¿ç”¨ <strong><code>Interface Class</code></strong> ä¹Ÿèƒ½åšåˆ°æ¥å£å’Œå®ç°çš„çœŸæ­£åˆ†ç¦»ï¼š</p>
<p>è¿™ç§æ–¹å¼å¸¸è§äºè¾“å‡ºåŠ¨æ€åº“ç»™åˆ°å®¢æˆ·ä½¿ç”¨ï¼Œå®¢æˆ·èƒ½è§åˆ°æ¥å£å®šä¹‰å’Œä½¿ç”¨ï¼Œä½†æ— æ³•çœ‹åˆ°å†…éƒ¨å®ç°ã€‚</p>
<p>ç”¨æ³•è¾ƒä¸ºå¸¸è§ï¼Œä¸èµ˜è¿°ï¼Œç›´æ¥<strong>show-code</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">//VirtualPerson.h   //å’Œ libæ–‡ä»¶ä¸€èµ·æä¾›ç»™åˆ°å®¢æˆ·
</span><span class="c1"></span><span class="k">class</span> <span class="nc">VirtualPerson</span> <span class="p">{</span> 
<span class="k">public</span><span class="o">:</span> <span class="c1">//createçš„è¿”å›å€¼è¿˜å¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œæ¢æˆRAIIçš„æ™ºèƒ½æŒ‡é’ˆ
</span><span class="c1"></span>    <span class="k">static</span> <span class="n">VirtualPerson</span> <span class="o">*</span> <span class="n">create</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">int</span> <span class="n">salary</span><span class="p">);</span>
    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Level</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Salary</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">VirtualPerson</span><span class="p">();</span><span class="c1">// avoid memory leak 
</span><span class="c1"></span><span class="p">};</span>
<span class="c1">//VirtualPerson.cpp  //æºç ä¸æä¾›ç»™å®¢æˆ·ï¼Œè€Œæ˜¯ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ libæ–‡ä»¶
</span><span class="c1"></span><span class="n">VirtualPerson</span><span class="o">*</span> <span class="n">VirtualPerson</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">int</span> <span class="n">salary</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">level</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//å·¥å‚æ–¹æ³•ï¼Œè¿˜å¯ä»¥ç”Ÿæˆå…¶ä»–å­ç±»
</span><span class="c1"></span>        <span class="k">return</span> <span class="k">new</span> <span class="nf">Engineer</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">salary</span><span class="p">);</span> 
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">VirtualPerson</span><span class="o">::~</span><span class="n">VirtualPerson</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="c1">// Engineer.h  //Engineerä¹Ÿæ˜¯å‚ä¸ç¼–è¯‘åˆ° libæ–‡ä»¶ä¸­
</span><span class="c1"></span><span class="k">class</span> <span class="nc">Engineer</span><span class="o">:</span> <span class="k">public</span> <span class="n">VirtualPerson</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Engineer</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span><span class="kt">int</span> <span class="n">salary</span><span class="p">);</span>
    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Level</span><span class="p">()</span> <span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Salary</span><span class="p">()</span> <span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">level_</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">salary_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h1 id="ch6-ç»§æ‰¿ä¸é¢å‘å¯¹è±¡è®¾è®¡">CH6. ç»§æ‰¿ä¸é¢å‘å¯¹è±¡è®¾è®¡</h1>
<h2 id="r32-ç¡®å®šä½ çš„publicç»§æ‰¿å¡‘é€ å‡ºis-aå…³ç³»">R32 ç¡®å®šä½ çš„publicç»§æ‰¿å¡‘é€ å‡º<strong>is-a</strong>å…³ç³»</h2>
<p>åŸä¹¦æ ‡é¢˜ï¼š<em><strong>Make sure public inheritance models &ldquo;is-a&rdquo;</strong></em>. ä¾¯æ·è€å¸ˆç¿»è¯‘ä¸ºâ€œå¡‘æ¨¡â€ï¼Œæˆ‘ä¸ªäººæ›´æ„¿æ„ç§°ä¸ºâ€œå¡‘é€ â€ã€‚</p>
<ul>
<li>
<p><strong>â€œpublicç»§æ‰¿â€æ„å‘³ç€is-a</strong></p>
<p>is-aï¼Œå³â€œ<strong>æ˜¯ä¸€ç§</strong>â€ï¼Œå°±æ˜¯è¯´ï¼Œé€‚ç”¨äºBase Classèº«ä¸Šçš„æ¯ä¸€ä»¶äº‹ï¼Œä¹Ÿä¸€å®šé€‚ç”¨äºDerived Classèº«ä¸Šã€‚</p>
</li>
</ul>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>By the way<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>é¢å‘è®¾è®¡å¯¹è±¡çš„è®¾è®¡æœ‰è‘—åçš„5å¤§åŸåˆ™ï¼Œ <strong><code>SOLID</code></strong> åŸåˆ™ï¼Œæ¯ä¸ªå­—æ¯åˆ†åˆ«ä»£è¡¨ä¸€ç§åŸåˆ™ï¼š</p>
<ul>
<li>
<p>S&ndash;å•ä¸€è´£ä»»åŸåˆ™(SRP) &ndash;Single Responsibility Principle</p>
</li>
<li>
<p>O&ndash;å¼€æ”¾å°é—­åŸåˆ™(OCP)&ndash; Open-Closed  Principle</p>
</li>
<li>
<p>L&ndash;é‡Œå¼æ›¿æ¢åŸåˆ™(LSP)&ndash; Liskov Substitution Principle</p>
</li>
<li>
<p>I â€“- æ¥å£åˆ†ç¦»åŸåˆ™(ISP)&ndash;Interface Segregation Principle</p>
</li>
<li>
<p>Dâ€“-ä¾èµ–å€’ç½®åŸåˆ™(DIP)&ndash; Dependency Inversion Principle</p>
</li>
</ul>
<p>æ›´è¯¦ç»†çš„å™è¿°å¯ä»¥å‚è€ƒï¼š<a href="https://cloud.tencent.com/developer/article/1503629" target="_blank" rel="noopener noreffer"><em>è…¾è®¯äº‘ï¼šSOLIDåŸåˆ™</em></a></p>
</div>
        </div>
    </div>
<p>æœ¬èŠ‚æ¡æ¬¾çš„ä¸­å¿ƒæ€æƒ³å³<em>é‡Œæ°æ›¿æ¢åŸåˆ™</em> ï¼š<strong>ä¸€ä¸ªå¯¹è±¡å‡ºç°çš„åœ°æ–¹éƒ½å¯ä»¥ç”±å…¶å­ç±»ä»£æ›¿å¹¶ä¸”ä¸ä¼šå‡ºé”™</strong>ã€‚</p>
<p>ç»§æ‰¿å…³ç³»æœ‰æ—¶å€™å¬èµ·æ¥å¾ˆå¥½ç†è§£ï¼Œæ¯”å¦‚ <code>Class Student: public Person</code>  ç†æ‰€åº”å½“ï¼Œä½†æœ‰æ—¶ä¹Ÿä¼šå¯¼è‡´è¯¯è§£ã€‚æ¯”å¦‚ä¼é¹…å±äºé¸Ÿç±»ï¼Œä½†ä¼é¹…ä¸ä¼šé£ï¼Œé‚£ä¹ˆåŸºç±»<code>Bird::Fly</code>æ–¹æ³•åˆå½“å¦‚ä½•å¤„ç†ï¼Œä¸‹æ–¹æ»¡è¶³è®¾è®¡æ„å›¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Bird</span><span class="p">{</span>   <span class="c1">//... ä¸å£°æ˜Fly()æ–¹æ³•
</span><span class="c1"></span><span class="p">};</span>
<span class="k">class</span> <span class="nc">FylingBird</span><span class="o">:</span><span class="k">public</span> <span class="n">Bird</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span> <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Fly</span><span class="p">();</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">Penguin</span><span class="o">:</span> <span class="k">public</span> <span class="n">Bird</span><span class="p">{</span> <span class="c1">//... ä¸å£°æ˜Fly()æ–¹æ³•
</span><span class="c1"></span><span class="p">};</span>
<span class="c1">// æ³¨ï¼šå¦‚æœBirdç±»ä»¥åŠå­ç±»éƒ½ä¸è€ƒè™‘Fly()æ–¹æ³•ï¼Œé‚£ä¹ˆPenguinç›´æ¥ç»§æ‰¿äºBirdå³å¯
</span></code></pre></td></tr></table>
</div>
</div><p>è¿˜æœ‰å¦ä¸€ç§åœºæ™¯ï¼Œçˆ¶ç±»å’Œå­ç±»å¯¹äºåŒä¸€ä¸ªæ–¹æ³•çš„æ•°æ®ä¿®æ”¹è§„åˆ™ä¸åŒï¼Œå¯¼è‡´äº†ç»§æ‰¿ä½“ç³»çš„ç¼ºé™·ã€‚</p>
<p>æ¯”å¦‚<code>Class Square:public Rectangle</code> $\rightarrow$ æ­£æ–¹å½¢ç»§æ‰¿äºé•¿æ–¹å½¢ï¼Œä½†æ˜¯è€ƒè™‘è¿™æ ·ä¸€ä¸ª<strong>ç±»å¤–æ–¹æ³•</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">makeBigger</span><span class="p">(</span><span class="n">Rectangle</span><span class="o">&amp;</span> <span class="n">r</span><span class="p">){</span>  <span class="c1">//æ™®é€šéæˆå‘˜å‡½æ•°
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">oldHeight</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">height</span><span class="p">();</span>
    <span class="n">r</span><span class="p">.</span><span class="n">setWidth</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span><span class="c1">//å¦‚æœræ˜¯Squqreï¼Œå¯èƒ½å†…éƒ¨è‡ªåŠ¨å°±é•¿å®½ä¸€èµ·å˜äº†
</span><span class="c1"></span>    <span class="n">assert</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">height</span><span class="p">()</span> <span class="o">==</span> <span class="n">oldHeight</span><span class="p">);</span><span class="c1">//è¿™ä¸ªassertå¯¹äºæ­£æ–¹å½¢å°±ä¸åˆé€‚äº†,è´¸ç„¶å»é™¤åˆè¿èƒŒè®¾è®¡æœ¬æ„
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>åº”å¯¹ä¸Šè¿°è¿™æ ·çš„æƒ…å†µï¼Œå°±éœ€è¦ä¿®æ”¹è®¾è®¡æˆ–ä¿®æ”¹ç»§æ‰¿ä½“ç³»äº†ã€‚</p>
<hr>
<h2 id="r33-é¿å…é®æ©ç”±ç»§æ‰¿å¾—æ¥çš„åç§°">R33 é¿å…é®æ©ç”±ç»§æ‰¿å¾—æ¥çš„åç§°</h2>
<p>é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯åç§°çš„é®æ©ï¼Œé€šä¿—åœ°è¯´ï¼Œæ˜¯æŒ‡ç”±äºä½œç”¨åŸŸä¸åŒå¸¦æ¥çš„å˜é‡åè¦†ç›–ã€‚è€ƒè™‘ä¸‹æ–¹ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">someFunc</span><span class="p">(){</span>
    <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;x is&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// localä½œç”¨åŸŸæ‰¾åˆ°äº†xï¼Œç›´æ¥è¦†ç›–å…¨å±€çš„xï¼Œè¾“å‡º0.1
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆå¦‚æœå°†ç»§æ‰¿ä½“ç³»è€ƒè™‘è¿›æ¥å‘¢ï¼š<strong>Derivedçš„ä½œç”¨åŸŸä¼šè¦†ç›–Baseçš„ä½œç”¨åŸŸ</strong>ï¼ŒåŒ…æ‹¬virtualå’Œnon-virtualã€‚è€ƒè™‘ä¸‹æ–¹ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Base</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">mf1</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">mf1</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Base::mf1():x =&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">mf2</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Base::mf2()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">mf3</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Base::mf3()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">mf3</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Base::mf3():x =&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">Base</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">Derived</span> <span class="o">:</span><span class="k">public</span> <span class="n">Base</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">mf1</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Derived::mf1()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">mf3</span><span class="p">(){</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Derived::mf3()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>å¾ˆæ˜æ˜¾å­˜åœ¨åç§°é®æ©çš„é—®é¢˜ï¼ŒDerivedçš„mf1ï¼Œmf3ä¼šé®æ©å­ç±»çš„æ‰€æœ‰åŒåå‡½æ•°ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Derived</span> <span class="n">d</span><span class="p">;</span>
<span class="n">d</span><span class="p">.</span><span class="n">mf1</span><span class="p">();</span>      <span class="c1">//OKï¼Œè¾“å‡º: Derived::mf1()
</span><span class="c1">//d.mf1(100);  ç¼–è¯‘æŠ¥é”™ï¼Œå› ä¸ºåç§°è¢«é®æ©
</span><span class="c1"></span><span class="n">d</span><span class="p">.</span><span class="n">mf2</span><span class="p">();</span>      <span class="c1">//OKï¼Œè¾“å‡º: Base::mf2()
</span><span class="c1"></span><span class="n">d</span><span class="p">.</span><span class="n">mf3</span><span class="p">();</span>      <span class="c1">//OKï¼Œè¾“å‡º: Derived::mf3()
</span><span class="c1">//d.mf3(300);  ç¼–è¯‘æŠ¥é”™ï¼ŒåŒç†
</span><span class="c1"></span><span class="n">d</span><span class="p">.</span><span class="n">Base</span><span class="o">::</span><span class="n">mf3</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span> <span class="c1">//OKï¼Œè¾“å‡º: Base::mf3():x =300 . ä½†æ˜¯ä¸å¤ªå»ºè®®è¿™ä¹ˆå†™ï¼Œä¸‘ï¼ï¼
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨usingå£°æ˜å¼æˆ–è½¬å‘å‡½æ•°</p>
<ol>
<li>
<p>using å£°æ˜å¼</p>
<p>å¯ä»¥ä½¿ç”¨usingå£°æ˜å¼ï¼Œè®©Derivedå¯ä»¥å¿½ç•¥åç§°é®æ©ï¼Œçœ‹åˆ°Baseä½œç”¨åŸŸå†…çš„å‡½æ•°ã€‚å¯ä»¥è®©ä¸Šæ–¹ä»£ç çš„â€œç¼–è¯‘æŠ¥é”™â€æ¶ˆå¤±ï¼Œæ­£å¸¸è°ƒç”¨d.mf1(100)å’Œd.mf3(300)ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Derived</span> <span class="o">:</span><span class="k">public</span> <span class="n">Base</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span> <span class="c1">//ä¿®æ”¹æœ¬èŠ‚å†…å®¹ä¸­ä¸Šæ–¹ä»£ç çš„Derivedç±»çš„å£°æ˜
</span><span class="c1"></span>    <span class="k">using</span> <span class="n">Base</span><span class="o">::</span><span class="n">mf1</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">Base</span><span class="o">::</span><span class="n">mf3</span><span class="p">;</span> <span class="c1">//è¿™2ä¸ªusingä½¿å¾—Baseç±»ä½œç”¨åŸŸå†…æ‰€æœ‰mf1,mf3å‡½æ•°éƒ½å¯è§
</span><span class="c1"></span>    <span class="c1">// ... å…¶ä»–ï¼Œç•¥
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>è½¬å‘å‡½æ•°(forwarding function)</p>
<p>åº”ç”¨åœºæ™¯ï¼šåœ¨privateç»§æ‰¿ä¸‹ï¼Œå¼ºè°ƒçš„æ˜¯ç»§æ‰¿å®ç°è€Œéç»§æ‰¿æ¥å£ï¼Œå¦‚æœæƒ³åœ¨å­ç±»çš„æˆå‘˜ä¸­è°ƒç”¨çˆ¶ç±»å‡½æ•°ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡<strong>å‡½æ•°è½¬å‘</strong>æ¥å®ç°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Derived</span><span class="o">:</span> <span class="k">private</span> <span class="n">Base</span><span class="p">{</span> <span class="c1">//æ”¹å†™æœ¬èŠ‚ä¸Šæ–¹ä»£ç ï¼Œæ³¨æ„ï¼Œæ˜¯ç§æœ‰ç»§æ‰¿
</span><span class="c1"></span><span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">mf1</span><span class="p">(){</span>
        <span class="n">Base</span><span class="o">::</span><span class="n">mf1</span><span class="p">();</span> <span class="c1">//æ‹¿åˆ°äº†çˆ¶ç±»çš„å‡½æ•°å®ç°
</span><span class="c1"></span>        <span class="c1">// ... è¯¥å‡½æ•°å…¶ä»–éƒ¨åˆ†
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">};</span>
<span class="c1">// åº”ç”¨ä»£ç 
</span><span class="c1"></span><span class="n">Derived</span> <span class="n">d</span><span class="p">;</span> 
<span class="n">d</span><span class="p">.</span><span class="n">mf1</span><span class="p">();</span>    <span class="c1">//è°ƒç”¨æˆåŠŸï¼ŒDerived::mf1
</span><span class="c1"></span><span class="n">d</span><span class="p">.</span><span class="n">mf1</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>  <span class="c1">//ç¼–è¯‘å¤±è´¥
</span></code></pre></td></tr></table>
</div>
</div><p>å½“ç„¶ï¼Œpublicç»§æ‰¿ä¹Ÿèƒ½ä½¿ç”¨è½¬å‘å‡½æ•°ï¼Œå†™å‡º<code>d.Base::mf3(300);</code> è¿™æ ·çš„ä»£ç ã€‚ä½†æ˜¯ï¼Œä¸€æ¥publicç»§æ‰¿ç†åº”éµå¾ª&quot;is-a&quot;è§„åˆ™ï¼Œusingå£°æ˜æ‹¿åˆ°æ‰€æœ‰è¢«é®æ©çš„æ¥å£ï¼›äºŒæ¥æ˜æ˜¾ä»£ç ä¸ç¾è§‚ã€‚</p>
</li>
</ol>
</li>
</ul>
<hr>
<h2 id="r34-åŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿">R34 åŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿</h2>
<p>å½“ä¸€ä¸ªå­ç±»Derivedç»§æ‰¿äºçˆ¶ç±»Baseï¼Œé‚£ä¹ˆè¦æ—¶åˆ»æ¸…æ¥šï¼Œå¯¹äºç±»ä¸­çš„æˆå‘˜å‡½æ•°ï¼Œæ˜¯æƒ³ç»§æ‰¿çˆ¶ç±»çš„æ¥å£ï¼Œè¿˜æ˜¯æƒ³ç»§æ‰¿çˆ¶ç±»çš„å®ç°ã€‚</p>
<ul>
<li>
<p><strong>å¯¹äºPublicç»§æ‰¿ï¼Œæ¥å£æ€»æ˜¯ä¼šè¢«ç»§æ‰¿</strong></p>
<p>åŸºäºâ€œ<strong>is-a</strong>â€çš„å…³ç³»ï¼Œä½œç”¨äºçˆ¶ç±»çš„ä»»ä½•äº‹æƒ…ä¹Ÿä¸€å®šè¦é€‚ç”¨äºå­ç±»ã€‚</p>
</li>
<li>
<p><strong>å£°æ˜çº¯è™šå‡½æ•°(pure-virtual)çš„ç›®çš„æ˜¯è®©å­ç±»åªç»§æ‰¿å‡½æ•°æ¥å£</strong></p>
<p>å¯¹äºçº¯è™šå‡½æ•°ï¼Œå­ç±»å¿…é¡»é‡æ–°å®ç°è¯¥æ¥å£ã€‚æ³¨æ„ï¼Œ<code>çˆ¶ç±»å¯ä»¥é€‰æ‹©æ€§ç»™å‡ºçº¯è™šå‡½æ•°çš„å®ç°</code>ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ä¼šç»™ã€‚</p>
</li>
<li>
<p><strong>éšæ‚£ï¼šä»éçº¯è™šå‡½æ•°(impure-virtual)åŒæ—¶ç»§æ‰¿æ¥å£å’Œç¼ºçœå®ç°</strong></p>
<p>éçº¯è™šå‡½æ•°ï¼Œå¯ä»¥è®©å­ç±»é€‰æ‹©æ˜¯å¦é‡æ–°å®ç°è¯¥æ¥å£ã€‚é‚£ä¹ˆï¼Œå¦‚æœå­ç±»æ˜¯æœ‰å¿…è¦é‡å†™ï¼Œä½†æ˜¯<strong>å¿˜è®°å†™äº†</strong>å´é»˜é»˜ç”¨çˆ¶ç±»ç‰ˆæœ¬ï¼Œä¾¿äº‹ä¸æ„¿è¿äº†ã€‚</p>
<p>ä¸¾ä¾‹ï¼šçˆ¶ç±»Airplaneæœ‰å­ç±»PlaneModelAã€PlaneModelBã€PlaneModelCï¼Œå…¶ä¸­Cå‹é£æœºä¸åŒäºABå‹ï¼Œæ˜¯æ–°å¼é£æœºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Airport</span> <span class="p">{...};</span><span class="c1">//æœºåœºç±»ï¼Œå®ç°ç•¥
</span><span class="c1"></span><span class="k">class</span> <span class="nc">Airplane</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">fly</span><span class="p">(</span><span class="k">const</span> <span class="n">Airport</span><span class="o">&amp;</span> <span class="n">destination</span><span class="p">);</span><span class="c1">//çˆ¶ç±»è¿˜ä¼šç»™å‡ºé»˜è®¤çš„flyå®ç°
</span><span class="c1"></span><span class="p">};</span>
<span class="k">class</span> <span class="nc">PlaneModelA</span><span class="o">:</span> <span class="k">public</span> <span class="n">Airplane</span><span class="p">{</span> <span class="p">...</span> <span class="p">};</span> <span class="c1">// ä¸é‡å†™flyï¼Œç»§æ‰¿çˆ¶ç±»çš„flyå®ç°
</span><span class="c1"></span><span class="k">class</span> <span class="nc">PlaneModelB</span><span class="o">:</span> <span class="k">public</span> <span class="n">Airplane</span><span class="p">{</span> <span class="p">...</span> <span class="p">};</span> <span class="c1">// Bå’ŒAä¸€æ ·
</span><span class="c1"></span><span class="k">class</span> <span class="nc">PlaneModelC</span><span class="o">:</span> <span class="k">public</span> <span class="n">Airplane</span><span class="p">{</span> <span class="p">...</span> <span class="p">};</span> <span class="c1">//æ–°å‹é£æœºï¼Œæœ¬æ¥è¦é‡å†™flyï¼Œç»“æœå¿˜äº†
</span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆè¿™ä¸ª<code>éšæ‚£è¯¥å¦‚ä½•è§£å†³</code> å‘¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å®ç°Cå‹é£æœºç±»æ—¶åˆ«å¿˜äº†flyæ–¹æ³•ï¼Ÿ</p>
<p>æ ¸å¿ƒæ€æƒ³æ˜¯â€œåˆ‡æ–­<code>virtualå‡½æ•°æ¥å£</code>å’Œå…¶<code>é»˜è®¤å®ç°</code>ä¹‹é—´çš„è¿æ¥â€ã€‚</p>
<ol>
<li>
<p>æ–¹æ³•1ï¼šè®¾ç½®flyä¸ºçº¯è™šå‡½æ•°ï¼Œå¹¶æ–°å¢ä¸€ä¸ªdefaultyFlyæ–¹æ³•</p>
<p>æ³¨æ„ç»†èŠ‚ï¼šdefaultFlyæ–¹æ³•è¦è®¾ç½®ä¸ºprotectedå±æ€§çš„non-virtualå‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Airplane</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">fly</span><span class="p">(</span><span class="k">const</span> <span class="n">Airport</span><span class="o">&amp;</span> <span class="n">destination</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="c1">// çˆ¶ç±»ä¸ç»™å‡ºå®ç°
</span><span class="c1"></span><span class="k">protected</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">defaultFly</span><span class="p">(</span><span class="k">const</span> <span class="n">Airport</span><span class="o">&amp;</span> <span class="n">destination</span><span class="p">){</span> <span class="p">...</span> <span class="p">}</span><span class="c1">//é»˜è®¤çš„flyå®ç°
</span><span class="c1"></span><span class="p">};</span>
<span class="k">class</span> <span class="nc">PlaneModelA</span><span class="o">:</span> <span class="k">public</span> <span class="n">Airplane</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>   <span class="c1">//çº¯è™šæ¥å£,å­ç±»å¿…é¡»ç»™å‡ºå®ç°
</span><span class="c1"></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">fly</span><span class="p">(</span><span class="k">const</span> <span class="n">Airport</span><span class="o">&amp;</span> <span class="n">destination</span><span class="p">){</span>
        <span class="n">defaultFly</span><span class="p">(</span><span class="n">destination</span><span class="p">);</span> <span class="c1">//è°ƒç”¨çˆ¶ç±»çš„ç¼ºçœå®ç°
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">};</span><span class="c1">//PlaneModelB å’Œ PlaneModelA ç±»ä¼¼,ç•¥
</span><span class="c1"></span><span class="k">class</span> <span class="nc">PlaneModelC</span><span class="o">:</span> <span class="k">public</span> <span class="n">Airplane</span><span class="p">{</span> <span class="p">...};</span><span class="c1">// é‡å†™flyæ–¹æ³•
</span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å†™è¿˜æœ‰ä¸ªå¥½å¤„ï¼šfly()å’ŒdefaultFly()äº«æœ‰ä¸åŒçš„ä¿æŠ¤çº§åˆ«ã€‚</p>
</li>
<li>
<p>æ–¹æ³•2ï¼š çˆ¶ç±»çš„é»˜è®¤å®ç°å¡åˆ°çº¯è™šæ¥å£flyä¸­</p>
<p>è¿™æ ·å°±ä¸éœ€è¦å®šä¹‰defaultFlyæ–¹æ³•äº†ï¼Œå› ä¸ºå­ç±»å¿…é¡»å®ç°flyæ–¹æ³•ï¼Œå¯¹äºA å‹ã€Bå‹é£æœºï¼Œå­ç±»fly()è½¬å‘ä¸€æ¬¡çˆ¶ç±»çš„fly()å³å¯ï¼ŒCç±»é£æœºå®ç°æ–°å¼çš„fly()ã€‚ç¼ºç‚¹æ˜¯è®©åŸæœ¬åœ¨defaultFlyå†…çš„å®ç°å†…å®¹æš´éœ²åœ¨å¤–äº†(æŒ‡publicå±æ€§)ã€‚</p>
<blockquote>
<p>By The Way:</p>
<p>ä¸ªäººè®¤ä¸ºï¼Œè¿™æ–¹æ³•2è¿˜æœ‰ä¸ªç¼ºç‚¹ï¼šå®ƒè®©è™šåŸºç±»çš„çº¯è™šæ¥å£æ‰¿è½½äº†æ¥å£å®ç°ï¼Œä¸å¤Ÿçº¯ç²¹(æ¯”å¦‚éœ€è¦è¾“å‡ºç»™åˆ°å®¢æˆ·ï¼Œåº”è¯¥åªç»§æ‰¿æ¥å£)ã€‚</p>
</blockquote>
</li>
</ol>
</li>
<li>
<p><strong>non-virtualå‡½æ•°å…·ä½“æŒ‡å®šæ¥å£ç»§æ‰¿å’Œå¼ºåˆ¶æ€§å®ç°ç»§æ‰¿</strong></p>
<p>å¦‚æœæˆå‘˜å‡½æ•°æ˜¯non-virtualï¼Œè¡¨ç¤ºå®ƒä¸æ‰“ç®—åœ¨å­ç±»ä¸­æœ‰ä¸åŒçš„è¡Œä¸ºï¼Œæˆ–è€…è¯´ï¼Œä¸å˜æ€§å‡Œé©¾äºç‰¹å¼‚æ€§ã€‚å¯¹åº”åœ°ï¼Œç»ä¸åº”è¯¥åœ¨å­ç±»ä¸­é‡å†™non-virtualå‡½æ•°ã€‚</p>
</li>
</ul>
<hr>
<h2 id="r35-è€ƒè™‘virtualå‡½æ•°çš„æ›¿ä»£é€‰æ‹©">R35 è€ƒè™‘virtualå‡½æ•°çš„æ›¿ä»£é€‰æ‹©</h2>
<p>å‡è®¾è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šè®¾è®¡ä¸€æ¬¾æ¸¸æˆï¼Œä¸åŒäººç‰©ä»¥ä¸åŒæ–¹å¼è®¡ç®—ç”Ÿå‘½å€¼ï¼Œé‚£ä¹ˆ$\Longrightarrow$ è®¾è®¡ç»§æ‰¿ä½“ç³»ï¼Œå­ç±»å…±åŒç»§æ‰¿çˆ¶ç±»çš„public-virtualæ–¹æ³•healthValue()ï¼Œå­ç±»å„è‡ªé‡æ–°å®ç°healthValue()æ¥å£ã€‚</p>
<p>ğŸ˜„å¾ˆå¥½ï¼Œ<strong>ä¸­è§„ä¸­çŸ©</strong>ï¼Œé‚£ä¹ˆï¼Œ<strong>æœ‰æ²¡æœ‰å…¶ä»–æ–¹å¼</strong>å‘¢ï¼Ÿ</p>
<ul>
<li>
<p><strong><code>NVIæ‰‹æ³•(non-virtual interface)å®ç°Template Methodæ¨¡å¼</code></strong></p>
<p>æ€è·¯å°±æ˜¯çˆ¶ç±»å®šä¹‰ä¸ªnon-virtualçš„publicæ–¹æ³•healthValue()ï¼Œè°ƒç”¨virtualçš„privateæ–¹æ³•healthValueImplã€‚å­ç±»ç›´æ¥é‡å†™healthValueImplï¼Œè¾¾åˆ°ç±»ä¼¼æ¨¡ç‰ˆæ–¹æ³•è®¾è®¡æ¨¡å¼çš„æ•ˆæœã€‚</p>
<p>çˆ¶ç±»<code>GameCharacter</code>è®¾è®¡å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">GameCharacter</span><span class="p">{</span><span class="c1">//æ„é€ å‡½æ•°å’Œè™šææ„å‡ç•¥å»
</span><span class="c1"></span><span class="k">public</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">healthValue</span><span class="p">()</span><span class="k">const</span><span class="p">{</span> <span class="c1">//ps:æ–¹ä¾¿å±•ç¤ºï¼Œè€Œå†™åœ¨äº†å¤´æ–‡ä»¶é‡Œï¼Œæˆäº†inline
</span><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&#34;Do prepare works...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span><span class="c1">//äº‹å‰ï¼Œå¦‚åŠ é”,å†™log,éªŒè¯æ¡ä»¶ç­‰ 
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">retVal</span> <span class="o">=</span> <span class="n">healthValueImpl</span><span class="p">();</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">Do post works...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span><span class="c1">//äº‹å,å¦‚è§£é”,æ›´æ–°æ•°æ®
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">retVal</span><span class="p">;</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">int</span> <span class="n">healthValueImpl</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span>
        <span class="kt">int</span> <span class="n">val</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;default caculate process... GetValue:&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">val</span><span class="p">;</span><span class="c1">//éšåè¿›è¡Œè®¡ç®—ï¼Œè¿‡ç¨‹ç•¥
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>å­ç±»<code>GoodGuy</code> å’Œ <code>BadGuy</code>è®¾è®¡å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">GoodGuy</span><span class="o">:</span><span class="k">public</span> <span class="n">GameCharacter</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">int</span> <span class="n">healthValueImpl</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span>
        <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;goodGuy caculate ... GetValue: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span><span class="p">;</span><span class="c1">//è¿‡ç¨‹ç•¥
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">BadGuy</span><span class="o">:</span><span class="k">public</span> <span class="n">GameCharacter</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">int</span> <span class="n">healthValueImpl</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span>
        <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;badGuy caculate ... GetValue: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span><span class="p">;</span><span class="c1">//è¿‡ç¨‹ç•¥
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>åº”ç”¨ç«¯ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">GameCharacter</span><span class="o">&gt;</span> <span class="n">pGood</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">GoodGuy</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">pGood</span><span class="o">-&gt;</span><span class="n">healthValue</span><span class="p">();</span> <span class="c1">//å¾—åˆ°60
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">GameCharacter</span><span class="o">&gt;</span> <span class="n">pBad</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">BadGuy</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">pBad</span><span class="o">-&gt;</span><span class="n">healthValue</span><span class="p">();</span><span class="c1">//å¾—åˆ°80
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong><code>ç”¨å‡½æ•°æŒ‡é’ˆå®ç°Strategyæ¨¡å¼</code></strong></p>
<p>ä¸»ä½“æ€æƒ³æ˜¯æ·»åŠ ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆä¸ºprivateæˆå‘˜å˜é‡pFuncï¼Œè¿™ä¸ªå‡½æ•°é€šè¿‡å¤–éƒ¨ä¼ å…¥ï¼Œä»è€Œå®ç°ä¸åŒçš„è¡Œä¸ºã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">GameCharacter</span><span class="p">;</span><span class="c1">//forward declaration
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">defaultHealthCalc</span><span class="p">(</span><span class="k">const</span> <span class="n">GameCharacter</span><span class="o">&amp;</span> <span class="n">gc</span><span class="p">);</span><span class="c1">//é»˜è®¤ç®—æ³•å®ç°
</span><span class="c1"></span><span class="k">class</span> <span class="nc">GameCharacter</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">HealthCalcFunc</span><span class="p">)(</span><span class="k">const</span> <span class="n">GameCharacter</span><span class="o">&amp;</span> <span class="n">gc</span><span class="p">);</span>
  <span class="k">explicit</span> <span class="nf">GameCharacter</span><span class="p">(</span><span class="n">HealthCalcFunc</span> <span class="n">hcf</span> <span class="o">=</span> <span class="n">defaultHealthCalc</span><span class="p">)</span><span class="o">:</span><span class="n">calcFunc_</span><span class="p">(</span><span class="n">hcf</span><span class="p">){}</span><span class="c1">//ä¼ å…¥å‡½æ•°æŒ‡é’ˆ,è‡ªå®šä¹‰å®ç°
</span><span class="c1"></span>  <span class="kt">int</span> <span class="nf">healthValue</span><span class="p">()</span><span class="k">const</span><span class="p">{</span>
    <span class="k">return</span> <span class="n">calcFunc_</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">HealthCalcFunc</span> <span class="n">calcFunc_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªè®¾è®¡æœ‰2ä¸ªæœ‰è¶£çš„<strong>è®¾è®¡å¼¹æ€§</strong>ï¼š</p>
<ol>
<li>å³ä½¿åŒä¸€ä¸ªäººç‰©ç±»å‹çš„ä¸åŒå®ä½“ï¼Œå…è®¸æ‹¥æœ‰ä¸åŒçš„ç”Ÿå‘½å€¼è®¡ç®—æ–¹æ³•ï¼›</li>
<li>æŸä¸ªäººç‰©å¯¹è±¡çš„ç”Ÿå‘½å€¼è®¡ç®—æ–¹æ³•ï¼Œåœ¨å…¶ç”Ÿå‘½æœŸå†…å¯ä»¥ä»»æ„ä¿®æ”¹ï¼Œåªè¦æ·»åŠ ä¸€ä¸ªsetæ–¹æ³•å³å¯ï¼›</li>
</ol>
</li>
<li>
<p><strong><code>ç”¨std::functionå®ç°Strategyæ¨¡å¼</code></strong></p>
<p>privateæˆå‘˜å˜é‡ç”±ä¸Šæ–‡çš„å‡½æ•°æŒ‡é’ˆæ›¿æ¢æˆstd::functionå¯¹è±¡ï¼Œç›¸å½“äºæ˜¯<code>æŒ‡å‘å‡½æ•°çš„æ³›åŒ–æŒ‡é’ˆ</code>ã€‚å°±<code>æ›´å…·è®¾è®¡å¼¹æ€§</code>äº†ã€‚std::functionå¯ä»¥ä¼ å…¥å‡½æ•°æŒ‡é’ˆã€ä»¿å‡½æ•°ã€std::bindå‡½æ•°å¯¹è±¡ã€‚GameCharacterçš„ç±»å®ç°ä¿®æ”¹ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">GameCharacter</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">int</span> <span class="p">(</span><span class="k">const</span> <span class="n">GameCharacter</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span>  <span class="n">healthCalcFunc</span><span class="p">;</span>
    <span class="k">explicit</span> <span class="nf">GameCharacter</span><span class="p">(</span><span class="n">healthCalcFunc</span> <span class="n">hcf</span> <span class="o">=</span> <span class="n">defaultHealthCalc</span><span class="p">)</span><span class="o">:</span><span class="n">healthValueImpl_</span><span class="p">(</span><span class="n">hcf</span><span class="p">){}</span>
    <span class="kt">int</span> <span class="nf">healthValue</span><span class="p">()</span><span class="k">const</span><span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&#34;Do prepare works...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">retVal</span> <span class="o">=</span> <span class="n">healthValueImpl_</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span> <span class="c1">//âš ï¸ è¿™é‡Œæ”¹äº†
</span><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">Do post works...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">retVal</span><span class="p">;</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">healthCalcFunc</span> <span class="n">healthValueImpl_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p>ä¼ å…¥å‡½æ•°æŒ‡é’ˆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"> <span class="n">gameChashort</span> <span class="nf">quickHurtHealthCalc</span><span class="p">(</span><span class="k">const</span> <span class="n">GameCharacter2</span><span class="o">&amp;</span> <span class="n">gc</span><span class="p">);</span><span class="c1">//è¿”å›å€¼ä¸æ˜¯int,å¯éšå¼è½¬æ¢;å®ç°ç•¥å»
</span><span class="c1">//åº”ç”¨ç«¯ä»£ç å¦‚ä¸‹ï¼š
</span><span class="c1"></span><span class="n">GameCharacter</span> <span class="nf">quickGuy</span><span class="p">(</span><span class="n">quickHurtHealthCalc</span><span class="p">);</span>
<span class="n">quickGuy</span><span class="p">.</span><span class="n">healthValue</span><span class="p">();</span><span class="c1">//å†…éƒ¨è°ƒç”¨quickHurtHealthCalc
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä¼ å…¥ä»¿å‡½æ•°</p>
<p>ä»¿å‡½æ•°ï¼šå³å‡½æ•°å¯¹è±¡ï¼Œè€Œä¸”é‡è½½äº†operator() ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">struct</span> <span class="nc">HealthCalculator</span><span class="p">{</span><span class="c1">//
</span><span class="c1"></span>    <span class="kt">int</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">GameCharacter2</span><span class="o">&amp;</span> <span class="n">gc</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="mi">180</span><span class="p">;</span><span class="c1">//çœç•¥å®ç°
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">};</span>
<span class="c1">//åº”ç”¨ç«¯ä»£ç å¦‚ä¸‹ï¼š
</span><span class="c1"></span><span class="n">GameCharacter</span> <span class="nf">functorGuy</span><span class="p">(</span> <span class="p">(</span><span class="n">HealthCalculator</span><span class="p">())</span> <span class="p">);</span><span class="c1">//ç”¨æ‹¬å·å°†ä»¿å‡½æ•°æ‹¬èµ·æ¥
</span><span class="c1"></span><span class="n">functorGuy</span><span class="p">.</span><span class="n">healthValue</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä¼ å…¥<code>std::bind</code>å‡½æ•°å¯¹è±¡</p>
<p>std::bindæ˜¯å‡½æ•°å¯¹è±¡æ¨¡æ¿ï¼Œæ¥æ”¶ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆfå’Œè‹¥å¹²å‡½æ•°å…¥å‚å¾—åˆ°fObjï¼Œè°ƒç”¨fObjç­‰åŒäºè°ƒç”¨å¸¦å‚æ•°çš„fã€‚æœ¬ä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">GameLevel</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span> <span class="c1">//ç”¨ç±»å†…å‡½æ•°ä½œä¸ºå‡½æ•°æŒ‡é’ˆf
</span><span class="c1"></span>    <span class="kt">float</span> <span class="n">health</span><span class="p">(</span><span class="k">const</span> <span class="n">GameCharacter</span><span class="o">&amp;</span> <span class="n">gc</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">20.3</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="c1">//åº”ç”¨ç«¯ä»£ç å¦‚ä¸‹ï¼š
</span><span class="c1"></span><span class="n">GameLevel</span>  <span class="n">curLevel</span><span class="p">;</span>
<span class="n">GameCharacter</span> <span class="nf">levelGuy</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GameLevel</span><span class="o">::</span><span class="n">health</span><span class="p">,</span> <span class="n">curLevel</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span>
<span class="n">levelGuy</span><span class="p">.</span><span class="n">healthValue</span><span class="p">();</span><span class="c1">//å†…éƒ¨è°ƒç”¨ç­‰ä»·äºcurLevel.health(leveGuy);
</span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
</li>
</ul>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>By the way<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>å…¶å®è¿™é‡Œä¼ å…¥C++11æ–°å¢çš„Lambdaè¡¨è¾¾å¼ä½œä¸ºstd::functionä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè€Œä¸”æ›´æ–¹ä¾¿ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp">  <span class="n">GameCharacter</span>  <span class="nf">lamGuy</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span> <span class="n">GameCharacter</span><span class="o">&amp;</span> <span class="n">gc</span><span class="p">){</span>
     <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&#34;value is &#34;</span> <span class="o">&lt;&lt;</span> <span class="mi">75</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="c1">//å…·ä½“è®¡ç®—ç•¥
</span><span class="c1"></span>	   <span class="k">return</span> <span class="mi">75</span><span class="p">;</span>
	   <span class="p">});</span>
  <span class="n">lamGuy</span><span class="p">.</span><span class="n">healthValue</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><p>å…³äºStrategyè®¾è®¡æ¨¡å¼æ›´å¤šå‚è€ƒï¼š</p>
<ul>
<li><a href="https://refactoringguru.cn/design-patterns/strategy" target="_blank" rel="noopener noreffer">Strategyè®¾è®¡æ¨¡å¼-åŸç†è®²è§£</a></li>
<li><a href="https://refactoringguru.cn/design-patterns/strategy/cpp/example" target="_blank" rel="noopener noreffer">Strategyè®¾è®¡æ¨¡å¼-C++ä»£ç å‚è€ƒ</a></li>
</ul>
</div>
        </div>
    </div>
<hr>
<h2 id="r36-ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°">R36 ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°</h2>
<ul>
<li>
<p>ç”±äºåç§°é®æ©ï¼Œä¸è¦é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°</p>
<p>çœ‹ä¸ªåä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">B</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">mf</span><span class="p">(){</span>
       <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;B::mf()&#34;</span><span class="p">;</span> 
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">D</span><span class="o">:</span> <span class="k">public</span> <span class="n">B</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">mf</span><span class="p">(){</span><span class="c1">//é‡æ–°å®šä¹‰mf()ï¼Œè¿åäº†Rule33
</span><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;D::mf()&#34;</span><span class="p">;</span> 
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆçœ‹è¿™æ ·çš„åº”ç”¨ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">D</span> <span class="n">d</span><span class="p">;</span>
<span class="n">D</span><span class="o">*</span> <span class="n">pD</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">;</span>
<span class="n">B</span><span class="o">*</span> <span class="n">pB</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">;</span>
<span class="n">d</span><span class="p">.</span><span class="n">mf</span><span class="p">();</span>    <span class="c1">// è¾“å‡º D::mf()
</span><span class="c1"></span><span class="n">pD</span> <span class="o">-&gt;</span> <span class="n">mf</span><span class="p">();</span><span class="c1">// è¾“å‡º D::mf()
</span><span class="c1"></span><span class="n">pB</span> <span class="o">-&gt;</span> <span class="n">mf</span><span class="p">();</span><span class="c1">// è¾“å‡º B::mf()
</span></code></pre></td></tr></table>
</div>
</div><p>è¿™å°±å¾ˆè¯¡å¼‚äº†ï¼éƒ½é€šè¿‡å¯¹è±¡dè°ƒç”¨æˆå‘˜å‡½æ•°mfï¼Œè°ƒç”¨ç»“æœåº”è¯¥ç›¸åŒã€‚</p>
<p>å¦å¤–ä¸€ç‚¹ï¼Œå‡ºäºpublicç»§æ‰¿çš„â€œ<strong>is-a</strong>â€ç‰¹æ€§ï¼Œè¿™æ ·é‡æ–°å®šä¹‰non-virtualå‡½æ•°ä¹Ÿæ˜¯å¯¹&quot;<strong>is-a</strong>&ldquo;çš„<strong>ä¸¥é‡è¿èƒŒ</strong>ã€‚</p>
</li>
</ul>
<hr>
<h2 id="r37-ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå…¥å‚å€¼">R37 ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå…¥å‚å€¼</h2>
<p>è¿™é‡Œè¯´çš„ç¼ºçœå…¥å‚ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°å…¥å‚çš„é»˜è®¤å€¼ï¼Œåœ¨é‡å†™å¸¦æœ‰<strong>ç¼ºçœå…¥å‚çš„virtualå‡½æ•°</strong>æ—¶ï¼Œä¸è¦ä¿®æ”¹é‚£ä¸ªé»˜è®¤å‚æ•°çš„é»˜è®¤å€¼ã€‚</p>
<p>åŸå› ï¼švirtualå‡½æ•°ä¸º<code>åŠ¨æ€ç»‘å®š</code>ç‰¹æ€§ï¼Œè€Œç¼ºçœå‚æ•°å€¼æ˜¯<code>é™æ€ç»‘å®š</code>ç‰¹æ€§ã€‚ä¿®æ”¹åä¼šé€ æˆä¸€äº›ä»¤äººè´¹è§£çš„ç°è±¡ã€‚</p>
<p>è¯·çœ‹ä¸‹æ–¹<strong>åé¢æ•™æ</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">enum</span> <span class="k">class</span> <span class="nc">Color</span> <span class="p">{</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">GREEN</span> <span class="p">,</span><span class="n">BLUE</span> 
<span class="p">};</span>
<span class="k">class</span> <span class="nc">Shape</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>  <span class="c1">// ğŸ‰ï¼šçˆ¶ç±»é»˜è®¤å…¥å‚æ˜¯RED
</span><span class="c1"></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">Color</span> <span class="n">col</span> <span class="o">=</span> <span class="n">Color</span><span class="o">::</span><span class="n">RED</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Shape:col is &#34;</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">Rectangle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span><span class="p">{</span> <span class="c1">// ğŸ‰ï¼šå­ç±»ç±»ä¿®æ”¹é»˜è®¤å…¥å‚ä¸ºGREEN
</span><span class="c1"></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">Color</span> <span class="n">col</span> <span class="o">=</span> <span class="n">Color</span><span class="o">::</span><span class="n">GREEN</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Rectangle:col is &#34;</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆå½“å‡ºç°å…¸å‹åº”ç”¨åœºæ™¯<code>Base* pB=new Derived</code>æ—¶ï¼Œå°±ä¼šé€ æˆâ€œçˆ¶ç±»å­ç±»å„å‡ºä¸€åŠåŠ›â€çš„æƒ…å½¢ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Shape</span> <span class="o">*</span><span class="n">pRec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">();</span>
<span class="n">pRec</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">();</span> <span class="c1">// è¾“å‡ºï¼šRectangle:col is 0  ï¼ˆ0æ˜¯REDï¼‰
</span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœç¡®å®è°ƒç”¨å­ç±»drawï¼Œä½†æ˜¯é»˜è®¤å…¥å‚å–çš„æ˜¯åŸºç±»çš„ REDï¼Œè€Œéå­ç±»çš„GREENã€‚</p>
<p>é‚£æ€ä¹ˆä¿®æ”¹åˆé€‚å‘¢ï¼Œéƒ½å¸¦é»˜è®¤å‚æ•°ï¼Œä¸”å­ç±»çˆ¶ç±»ç›¸åŒï¼Ÿå¸¦æ¥ä¸€ä¸ª<strong>è€¦åˆé—®é¢˜</strong>ï¼Œå¦‚æœçˆ¶ç±»æ”¹äº†ï¼Œæ‰€æœ‰å­ç±»éƒ½å¾—æ”¹ã€‚</p>
<p>æ­£å¦‚Rule35æåˆ°çš„NVI(non-virtual interface)æ‰‹æ³•ï¼Œæ­¤å¤„ä¾¿æ˜¯ç»ä½³çš„åº”ç”¨åœºæ™¯$\Longrightarrow$ drawæ–¹æ³•æ”¹ä¸ºé»˜è®¤å‚æ•°çš„non-virtualï¼ŒæŠŠvirtualå‡½æ•°æ”¾åˆ°privateé‡Œå»ï¼Œä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Shape</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>   <span class="c1">//å­ç±»ç»§æ‰¿è¯¥é»˜è®¤å…¥å‚çš„non-virtualæ¥å£ï¼Œåˆ«é‡å†™
</span><span class="c1"></span>    <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">Color</span> <span class="n">col</span> <span class="o">=</span> <span class="n">Color</span><span class="o">::</span><span class="n">RED</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">drawImpl</span><span class="p">(</span><span class="n">col</span><span class="p">);</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span> <span class="c1">//çº¯è™šå‡½æ•°æ˜¯å¼ºåˆ¶å­ç±»é‡å†™ï¼Œçœ‹å…·ä½“æƒ…å†µï¼Œimpure-virtualä¹Ÿè¡Œ 
</span><span class="c1"></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">drawImpl</span><span class="p">(</span><span class="n">Color</span> <span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="c1">//å­ç±»é‡å†™è¿™ä¸ªdrawImpl
</span><span class="c1"></span><span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="r38-é€šè¿‡å¤åˆå¡‘é€ å‡ºhas-aæˆ–æ ¹æ®æŸç‰©å®ç°å‡º">R38 é€šè¿‡å¤åˆå¡‘é€ å‡º<strong>has-a</strong>æˆ–&quot;æ ¹æ®æŸç‰©å®ç°å‡º&rdquo;</h2>
<p>åŸä¹¦æ ‡é¢˜ï¼š<em><strong>Model â€œhas-aâ€ or â€œis-implemented-in-terms-ofâ€ through composition</strong></em>ï¼ŒåŒRule32ï¼Œä¾¯æ·è€å¸ˆç¿»è¯‘ä¸ºâ€œå¡‘æ¨¡â€ã€‚</p>
<p>å¤åˆå…³ç³»ï¼ˆcompositionï¼‰æ˜¯ä¸€ç§å¸¸è§çš„ç±»å…³ç³»ï¼Œå½“æŸç§ç±»å‹çš„å¯¹è±¡å†…å«æœ‰å®ƒç§ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œä¾¿æ˜¯æ­¤ç§å…³ç³»ã€‚</p>
<p>å¤åˆå…³ç³»åˆ†ä¸º2ç§ï¼š&quot;<code>has-a</code>&quot; å’Œ &ldquo;<code>is-implemented-in-terms-of</code>&quot;ã€‚</p>
<ul>
<li>
<p>â€œ<code>has-a</code>â€å…³ç³»ï¼š</p>
<p>æŒ‡çš„æ˜¯<strong>åº”ç”¨åŸŸ</strong>éƒ¨åˆ†ï¼Œä¸å‚ä¸å†…çš„å…·ä½“å„é¡¹å®ç°ã€‚æ˜¯ä¸€ç§å•çº¯çš„å®Œå¤‡å¯¹è±¡çš„åŒ…å«å…³ç³»ï¼Œæ¯”å¦‚Personç±»æœ‰Addressã€PhoneNumberã€Jobç­‰ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œåˆæˆ–æ˜¯Imageç±»æœ‰Bufferã€Mutexxã€SearchTreeç­‰ç±»å‹çš„æˆå‘˜ã€‚</p>
</li>
<li>
<p>&ldquo;<code>is-implemented-in-terms-of</code>&ldquo;å…³ç³»ï¼š<br>
æŒ‡çš„æ˜¯<strong>å®ç°åŸŸ</strong>éƒ¨åˆ†ï¼Œå‚ä¸ç±»çš„å„ç±»å®ç°ï¼Œæ¯”å¦‚æ•°æ®ç»“æ„çš„è®¾è®¡ä¸­ï¼Œæƒ³ç”¨ç°æœ‰çš„ std::listæ¥å®ç°Setç±»ï¼Œè¿™æ ·å¯èƒ½æ•ˆç‡ä¸é«˜(<em>é€šå¸¸æ›´å…·æ•ˆç‡çš„å®ç°æ˜¯é‡‡ç”¨å¹³è¡¡æŸ¥æ‰¾æ ‘</em> )ï¼Œä½†æ˜¯å¯è¡Œã€‚<br>
ğŸ“Œï¼šæ­¤å¤„ä¸èƒ½è®©Setä»¥publicç»§æ‰¿äºstd::listï¼Œå› ä¸ºlistå…è®¸é‡å¤å…ƒç´ ï¼Œè€ŒSetä¸è¡Œï¼Œä¸æ»¡è¶³â€œ<strong>is-a</strong>â€å…³ç³»ã€‚<br>
æ­£ç¡®å®ç°éƒ¨åˆ†ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Set</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">bool</span> <span class="n">contains</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">)</span><span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">rep_</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">rep_</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">item</span><span class="p">)</span> <span class="o">!=</span> <span class="n">rep_</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>  
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">contains</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="n">rep_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">);</span><span class="c1">// å®ç°ç•¥
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>  <span class="c1">// å®ç°ç•¥
</span><span class="c1"></span><span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">rep_</span><span class="p">;</span> <span class="c1">//ç”¨æ¥è¡¨è¿°Setçš„æ•°æ®
</span><span class="c1"></span><span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="r39-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿">R39 æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿</h2>
<p>â€œæ˜æ™ºè€Œå®¡æ…â€çš„æ„æ€æ˜¯ğŸ‘‰å½“è€ƒè™‘äº†å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”åï¼Œä»ç„¶è§‰å¾—privateç»§æ‰¿æ˜¯æœ€åˆé€‚çš„ï¼Œæ‰ä½¿ç”¨å®ƒã€‚</p>
<p>é¦–å…ˆæ˜ç¡®privateç»§æ‰¿çš„2ä¸ªç‰¹æ€§ï¼š</p>
<ol>
<li>ç¼–è¯‘å™¨ä¸ä¼šè‡ªåŠ¨å°†ä¸€ä¸ªderived-classå¯¹è±¡éšå¼è½¬æ¢ä¸ºbase-classå¯¹è±¡(å‡½æ•°å…¥å‚æ—¶)ï¼›</li>
<li>ç»§æ‰¿è€Œæ¥çš„æˆå‘˜ï¼Œåœ¨derived-classä¸­éƒ½ä¼šå˜æˆprivateå±æ€§ï¼›</li>
</ol>
<p>privateç»§æ‰¿çš„æ„ä¹‰ï¼šæ„å‘³ç€<strong>implemented-in-terms-of</strong>ï¼Œåœ¨ç±»å…³ç³»è®¾è®¡ä¸Šæ²¡æœ‰å¤ªå¤§æ„ä¹‰ï¼Œåªçœ‹é‡è½¯ä»¶å®ç°ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹ä½¿ç”¨privateçš„2ä¸ªåº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>
<p><strong>derived-classæƒ³ç»§æ‰¿base-classçš„æŸpublicæ¥å£å®ç°ï¼Œä½†åˆæƒ³éšè—æ­¤æ¥å£</strong></p>
<p>è€ƒè™‘å¦‚ä¸‹åº”ç”¨åœºæ™¯ï¼šå¯¹äºä¸€ä¸ªå·²çŸ¥çš„ç±»Widgetï¼Œæƒ³ç”¨å¦ä¸€ä¸ªå·²çŸ¥çš„è®¡æ—¶ç±»Timerè¾…åŠ©æ€§èƒ½åˆ†æï¼Œåœ¨å°½é‡å°æ”¹åŠ¨å·²æœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•å¯ç”¨Timerï¼Ÿ</p>
<p>privateç»§æ‰¿åšæ³•ï¼šè®©Widgetç±»privateç»§æ‰¿äºTimerï¼Œé‡å†™çˆ¶ç±»Timerçš„onTickå‡½æ•°ã€‚</p>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Timer</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">explicit</span> <span class="n">Timer</span><span class="p">(</span><span class="kt">int</span> <span class="n">tickFrequency</span><span class="p">);</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">onTick</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span><span class="c1">//å®šæ—¶å™¨æ»´ç­”ä¸€æ¬¡ï¼Œè‡ªåŠ¨è¢«è°ƒç”¨ä¸€æ¬¡
</span><span class="c1"></span><span class="p">};</span>
<span class="k">class</span> <span class="nc">Widget</span><span class="o">:</span><span class="k">private</span> <span class="n">Timer</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span> <span class="c1">//ğŸ˜‹ privateç»§æ‰¿è€Œæ¥çš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯privateå±æ€§
</span><span class="c1"></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">onTick</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span><span class="c1">//æŸ¥çœ‹å¹¶è®°å½•Widgetæ•°æ®ï¼Œèµ„æºç­‰
</span><span class="c1"></span><span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>è¯¥é—®é¢˜é™¤äº†ä¸Šæ–¹çš„privateç»§æ‰¿ï¼Œèƒ½ä¸èƒ½<strong>ç”¨å…¶ä»–æ–¹æ¡ˆæ›¿ä»£privateç»§æ‰¿</strong>å‘¢ï¼Ÿ</p>
<p>ğŸ‘‰ ğŸ‘‰â€œ<strong>publicç»§æ‰¿+å¤åˆ</strong>â€æ›¿ä»£privateç»§æ‰¿ï¼šåœ¨Widgetå†…éƒ¨åµŒå¥—å®šä¹‰privateå±æ€§çš„æ–°ç±»<code>WidgetTimer:private Timer</code>ï¼Œå³å¯åŒæ ·å¯ç”¨Timerä¸”éšè—äº†Timerã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Widget</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">class</span> <span class="nc">WidgetTimer</span><span class="o">:</span><span class="k">public</span> <span class="n">Timer</span><span class="p">{</span><span class="c1">// ç±»å†…åµŒå¥—å®šä¹‰
</span><span class="c1"></span>    <span class="k">public</span><span class="o">:</span>
        <span class="k">virtual</span> <span class="kt">void</span> <span class="n">onTick</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="n">WidgetTimer</span> <span class="n">wTimer_</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>â­â­ WidgetTimerä¹Ÿå¯ä»¥ä¸å®šä¹‰åœ¨Widgetç±»å†…,ç±»å†…åªæ”¾WidgetTimer* å’ŒWidgetTimerçš„å‰ç½®å£°æ˜ï¼Œå®Œå…¨è§£è€¦åˆï¼Œ<strong>é™ä½ç¼–è¯‘ä¾èµ–æ€§</strong>ã€‚è€Œè¿™æ ·çš„è®¾è®¡è‡ªç”±åº¦æ˜¯å•çº¯çš„privateç»§æ‰¿ä¸å…·å¤‡çš„ã€‚</p>
</li>
<li>
<p><strong>ç©ºç™½åŸºç±»æœ€ä¼˜åŒ–</strong>(<code>EBO</code>,empty base optimization)</p>
<p>âš¡å€¼å¾—ä¸€æï¼š<strong>ç©ºç±»</strong>(Empty Class)æ˜¯æŒ‡ä¸å«non-staticæ•°æ®æˆå‘˜å’Œvirtual-funcçš„ç±»ã€‚</p>
<p>ç©ºç±»çš„sizeä¼šè¢«C++å¼ºåˆ¶è¦æ±‚è‡³å°‘ä¸º1ï¼Œé€šå¸¸æ˜¯ç”¨1ä¸ªcharå ä½ã€‚å¦‚æœè®©Empty-Classä½œä¸ºæ•°æ®æˆå‘˜ï¼Œå› ä¸ºå†…å­˜å¯¹é½è€Œå¯¼è‡´Derived-Classæµªè´¹å†…å­˜ã€‚</p>
<p>ç¤ºä¾‹ä»£ç  ğŸ‘‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Empty</span> <span class="p">{</span> <span class="c1">// ç©ºç±»ï¼Œ1å­—èŠ‚. ä¸å«non-staticæ•°æ®ï¼Œä¸å«virtual
</span><span class="c1"></span> 	<span class="kt">void</span> <span class="nf">privteFoo</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;private non-virtual.&#34;</span><span class="p">;</span> 	<span class="p">}</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">typedef</span> <span class="kt">char</span><span class="o">*</span>  <span class="n">pChar</span><span class="p">;</span>
    <span class="k">typedef</span> <span class="nf">void</span><span class="p">(</span><span class="o">*</span><span class="n">pFuncReadData</span><span class="p">)(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">url</span><span class="p">);</span>
    <span class="k">enum</span> <span class="k">class</span> <span class="nc">clolr</span> <span class="p">{</span>
        <span class="n">red</span><span class="p">,</span><span class="n">green</span><span class="p">,</span><span class="n">blue</span>
    <span class="p">};</span>
    <span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;public non-virtual!&#34;</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="p">;</span><span class="c1">//static æ•°æ®ä¹Ÿä¸å±äºclasså®ä½“
</span><span class="c1"></span><span class="p">};</span>
<span class="k">class</span> <span class="nc">HoldsIntsAndEmpty</span> <span class="p">{</span> <span class="c1">//å†…å­˜å¯¹é½å12å­—èŠ‚
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">x_</span><span class="p">;</span>   <span class="c1">// 4å­—èŠ‚
</span><span class="c1"></span>    <span class="n">Empty</span> <span class="n">e_</span><span class="p">;</span> <span class="c1">// 1å­—èŠ‚
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">y_</span><span class="p">;</span>   <span class="c1">// 4å­—èŠ‚
</span><span class="c1"></span><span class="p">};</span>
<span class="k">class</span> <span class="nc">HoldsInts</span><span class="o">:</span><span class="k">private</span> <span class="n">Empty</span> <span class="p">{</span><span class="c1">//ä½¿ç”¨EBO,ç±»å¤§å°8å­—èŠ‚
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">x_</span><span class="p">;</span><span class="c1">//4å­—èŠ‚
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">y_</span><span class="p">;</span><span class="c1">//4å­—èŠ‚
</span><span class="c1"></span><span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>EBOä¼˜åŒ–å¯ä»¥å‡å°‘Derived-Classçš„å†…å­˜å¤§å°ï¼Œæ³¨æ„<code>EBOåªé€‚ç”¨äºå•ç»§æ‰¿</code>ã€‚</p>
</li>
</ul>
<hr>
<h2 id="r40-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿">R40 æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿</h2>
<p>å¤šé‡ç»§æ‰¿(multiple inheritance)æ˜¯æŒ‡ç»§æ‰¿ä¸€ä¸ªä»¥ä¸Šçš„çˆ¶ç±»ã€‚ä½†æ˜¯è¿™äº›çˆ¶ç±»åº”è¯¥é¿å…æ‹¥æœ‰å…±åŒçš„ç¥–çˆ¶ç±»ï¼Œä¼šå½¢æˆæ¯”è¾ƒéº»çƒ¦çš„â€œè±å½¢ç»§æ‰¿â€(æˆ–è€…å«é’»çŸ³ç»§æ‰¿)ã€‚</p>
<ul>
<li>
<p><strong>å¤šé‡ç»§æ‰¿çš„æˆæœ¬ä»¥åŠå‰¯ä½œç”¨</strong></p>
<p>ä¸Šé¢è¯´â€œè±å½¢ç»§æ‰¿â€æ¯”è¾ƒéº»çƒ¦ï¼Œä¸»è¦åŸå› æ˜¯å¦‚æœç¥–çˆ¶ç±»å¦‚æœæ‹¥æœ‰æŸä¸ªæˆå‘˜å˜é‡xï¼Œé‚£ä¹ˆ2ä¸ªçˆ¶ç±»åˆ†åˆ«publicå½¢å¼ç»§æ‰¿äº†xï¼Œåˆ°äº†ç›®æ ‡å­ç±»å°±æœ‰äº†2ä»½xã€‚</p>
<p>è§£å†³é—®é¢˜çš„åŠæ³•æ˜¯<strong>è™šç»§æ‰¿</strong>(virtual inheritance)ï¼Œå¦‚æ­¤ï¼Œä¸Šè¿°å­ç±»åªæœ‰ä¸€ä»½xã€‚ä¸ºä¿è¯è™šç»§æ‰¿çš„æ­£ç¡®æ€§ï¼Œç¼–è¯‘å™¨åœ¨èƒŒåéœ€è¦ä»˜å‡ºæ›´å¤šä»£ä»·ï¼Œå¯èƒ½é€ æˆå­ç±»å†…å­˜æ›´å¤§æˆ–è¿è¡Œé€Ÿåº¦æ›´æ…¢ã€‚</p>
<p>ğŸ‘‰å¦‚æœå­˜åœ¨è±å½¢ç»§æ‰¿ï¼Œé‚£ä¹ˆ<em>ç¥–çˆ¶ç±»å°½é‡ä¸è¦æŒæœ‰æ•°æ®æˆå‘˜ã€‚</em></p>
<p>è™šç»§æ‰¿ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">File</span><span class="p">{...};</span>  <span class="c1">//ç¥–çˆ¶ç±»æœ€å¥½ä¸è¦æŒæœ‰non-staticæ•°æ®æˆå‘˜
</span><span class="c1"></span><span class="k">class</span> <span class="nc">InputFile</span><span class="o">:</span> <span class="k">virtual</span> <span class="k">public</span> <span class="n">File</span><span class="p">{...};</span>
<span class="k">class</span> <span class="nc">OutputFile</span><span class="o">:</span> <span class="k">virtual</span> <span class="k">public</span> <span class="n">File</span><span class="p">{...};</span>
<span class="k">class</span> <span class="nc">IOFile</span><span class="o">:</span><span class="k">public</span> <span class="n">InputFile</span><span class="p">,</span><span class="k">public</span> <span class="n">OutputFile</span><span class="p">{...};</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>åº”ç”¨åœºæ™¯ï¼špublicç»§æ‰¿æ¥å£+privateç»§æ‰¿å®ç°</strong></p>
<p>æ€è€ƒè¿™æ ·çš„åº”ç”¨åœºæ™¯ï¼ŒPersonBaseç±»æ˜¯è™šåŸºç±»ï¼ŒRealPersonæ˜¯ç›®æ ‡å­ç±»ï¼ˆéœ€è¦ç»§æ‰¿æ¥å£ï¼‰ï¼Œä½†æ˜¯è·å–nameå’ŒbirthDateä¿¡æ¯çš„å‡½æ•°åœ¨å¦ä¸€ä¸ªPersonInfoç±»éƒ½æœ‰äº†ç°æˆçš„å®ç°ï¼ˆåªéœ€è¦ç®€å•ä¿®æ”¹è¯¥å®ç°ï¼‰ã€‚</p>
<p>ä¸¤è€…ç»“åˆåï¼Œå³è®©RealPersonç±»publicç»§æ‰¿äºPersonBaseï¼Œprivateç»§æ‰¿äºPersonInfoã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">PersonBase</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">PersonBase</span><span class="p">(){}</span>
    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">birthDate</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">PersonInfo</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span>  <span class="o">~</span><span class="n">PersonInfo</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">explicit</span> <span class="nf">PersonInfo</span><span class="p">(</span><span class="kt">int</span> <span class="n">pID</span><span class="p">)</span><span class="o">:</span><span class="n">id_</span><span class="p">(</span><span class="n">pID</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">theName</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span>
        <span class="k">static</span> <span class="kt">char</span> <span class="n">value</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
        <span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">exampleName</span> <span class="o">=</span> <span class="s">&#34;Luka&#34;</span><span class="p">;</span><span class="c1">// è®¡ç®—è¿‡ç¨‹ç•¥,ç”¨å›ºå®šå­—ç¬¦ä¸²æ›¿ä»£
</span><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">strcpy</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueDelimLeft</span><span class="p">());</span>   <span class="c1">// è·å–å·¦ç•Œå®šç¬¦
</span><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">strcat</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">exampleName</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">strcat</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueDelimRight</span><span class="p">());</span><span class="c1">// è·å–å³ç•Œå®šç¬¦
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">theBirthDate</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;1990-1-1&#34;</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">valueDelimLeft</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;[&#34;</span><span class="p">;</span> <span class="p">};</span>
    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">valueDelimRight</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;]&#34;</span><span class="p">;</span> <span class="p">};</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">id_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>å¤šé‡ç»§æ‰¿çš„ä»£ç ä¸ºğŸ‘‡:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">RealPerson</span> <span class="o">:</span><span class="k">public</span> <span class="n">PersonBase</span><span class="p">,</span> <span class="k">private</span> <span class="n">PersonInfo</span> <span class="p">{</span><span class="c1">//å¤šé‡ç»§æ‰¿
</span><span class="c1"></span><span class="k">public</span><span class="o">:</span>
    <span class="k">explicit</span> <span class="n">RealPerson</span><span class="p">(</span><span class="kt">int</span> <span class="n">pID</span><span class="p">)</span> <span class="o">:</span><span class="n">PersonInfo</span><span class="p">(</span><span class="n">pID</span><span class="p">)</span> <span class="p">{}</span> <span class="c1">// å§”æ‰˜æ„é€ 
</span><span class="c1"></span>    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span> <span class="c1">//å®ç°å¿…è¦çš„è™šåŸºç±»Personçš„pure-virtualæˆå‘˜å‡½æ•°
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">PersonInfo</span><span class="o">::</span><span class="n">theName</span><span class="p">();</span> 
    <span class="p">}</span>
    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">birthDate</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> 
        <span class="k">return</span> <span class="n">PersonInfo</span><span class="o">::</span><span class="n">theBirthDate</span><span class="p">();</span> 
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">valueDelimLeft</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">;</span> <span class="p">};</span><span class="c1">//é‡å†™ç•Œå®šç¬¦å‡½æ•°
</span><span class="c1"></span>    <span class="k">virtual</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">valueDelimRight</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">;</span> <span class="p">};</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>æœ€ååº”ç”¨ç«¯ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">RealPerson</span> <span class="nf">rPerson</span><span class="p">(</span><span class="mi">613</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rPerson</span><span class="p">.</span><span class="n">name</span><span class="p">();</span> <span class="c1">//è¾“å‡ºLuka ,è€Œä¸æ˜¯[Luka]
</span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ï¼Œå¤šé‡ç»§æ‰¿ä½“ç³»å®Œç¾è§£å†³è¯¥é—®é¢˜ã€‚</p>
</li>
</ul>
<p>å›åˆ°æœ¬èŠ‚å¼€å¤´ï¼Œæ˜æ™ºå’Œå®¡æ…çš„æ„æ€æ˜¯ğŸ‘‰å³ä½¿å¤šé‡ç»§æ‰¿å¯ä»¥ç”¨å•ç»§æ‰¿æ–¹æ¡ˆæ›¿ä»£è§£å†³ï¼Œæ€è€ƒåï¼Œå¦‚æœå¤šé‡ç»§æ‰¿ä¾ç„¶æ˜¯æœ€ç®€æ´ã€æœ€æ˜“ç»´æŠ¤ã€æœ€åˆç†çš„åšæ³•ï¼Œé‚£å°±é€‰æ‹©å®ƒã€‚</p>
<hr></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2022-04-21&nbsp;<a class="git-hash" href="https://github.com/kissingfire123/kissingfire123.github.io.git/commit/3ea15ca6992b2c3968b5ad76192923fa578624a4" target="_blank" title="commit by kissingfire123(lwy13697320205@163.com) 3ea15ca6992b2c3968b5ad76192923fa578624a4: &lt;published&gt; æ·»åŠ ç«™å†…æ–‡ç« æ€»å­—æ•°ç»Ÿè®¡">
                                    <i class="fas fa-hashtag fa-fw"></i>3ea15ca</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/" data-title="Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)" data-hashtags="C&#43;&#43;,ç¨‹åºè®¾è®¡"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/" data-hashtag="C&#43;&#43;"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° WhatsApp" data-sharer="whatsapp" data-url="https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/" data-title="Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/" data-title="Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/" data-title="Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)" data-image="/img/C&#43;&#43;-Pic/EffectiveC&#43;&#43;-FrontPage-part3.webp"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Myspace" data-sharer="myspace" data-url="https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/" data-title="Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)" data-description="æ‘˜è¦ï¼šEffective C&#43;&#43;(ç¬¬ä¸‰ç‰ˆ)å†…å®¹ç¬¬äº”ã€ç¬¬å…­ç« çš„æ€»ç»“"><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Blogger" data-sharer="blogger" data-url="https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/" data-title="Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)" data-description="æ‘˜è¦ï¼šEffective C&#43;&#43;(ç¬¬ä¸‰ç‰ˆ)å†…å®¹ç¬¬äº”ã€ç¬¬å…­ç« çš„æ€»ç»“"><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Evernote" data-sharer="evernote" data-url="https://kissingfire123.github.io/2022/02/14_effective-c-%E4%B9%8B%E9%98%85%E8%AF%BB%E6%80%BB%E7%BB%93%E4%B8%89/" data-title="Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/c&#43;&#43;/">C&#43;&#43;</a>,&nbsp;<a href="/tags/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/">ç¨‹åºè®¾è®¡</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2022/01/11_effective-c-%E4%B9%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%E4%BA%8C/" class="prev" rel="prev" title="Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)"><i class="fas fa-angle-left fa-fw"></i>Effective C&#43;&#43;(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)</a>
            <a href="/2022/02/18_%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8Fkatex%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/" class="next" rel="next" title="å¸¸ç”¨æ•°å­¦å…¬å¼æ’ç‰ˆKaTexè¯­æ³•æ€»ç»“">å¸¸ç”¨æ•°å­¦å…¬å¼æ’ç‰ˆKaTexè¯­æ³•æ€»ç»“<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container">
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            <div class="footer-line">
				<span > æœ¬ç«™ <i class='fas fa-thin fa-file-word'></i> æ€»è®¡ 84426 å­— </span>
            </div>

            <div class="footer-line">
				<span id="run-time"></span>
            </div>
            <div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Benjamin Lee</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/valine/Valine.min.js"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/algoliasearch/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/twemoji/twemoji.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":15},"comment":{"valine":{"appId":"6aYGah9X6KRekPxOkx2u3ozl-gzGzoHsz","appKey":"OPVQ1v39BIWr9GX8biOyPD8V","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":true,"highlight":true,"lang":"zh-cn","pageSize":10,"placeholder":"æœŸå¾…æ‚¨çš„è¯„è®º...","recordIP":true,"visitor":true}},"cookieconsent":{"content":{"dismiss":"åŒæ„","link":"äº†è§£æ›´å¤š","message":"æœ¬ç½‘ç«™ä½¿ç”¨ Cookies æ¥æ”¹å–„æ‚¨çš„æµè§ˆä½“éªŒ."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"A6CM5R0XT0","algoliaIndex":"Benjamin-Blog","algoliaSearchKey":"b0913834be4b9582dd1dedca5aa6312a","highlightTag":"em","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"type":"algolia"},"twemoji":true};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script><script type="text/javascript" src="/js/custom.js"></script></body>
</html>
